<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KaboreTech - Dashboard Admin</title>
    <style>
        :root {
            --primary-color: #4a6baf;
            --secondary-color: #f8f9fa;
            --accent-color: #ff6b6b;
            --dark-color: #343a40;
            --light-color: #ffffff;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            display: flex;
            min-height: 100vh;
            background-color: #f5f5f5;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--dark-color);
            color: var(--light-color);
            padding: 20px 0;
            transition: all 0.3s;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h3 {
            color: var(--light-color);
            font-size: 1.5rem;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .sidebar-menu ul {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: block;
            padding: 10px 20px;
            color: var(--light-color);
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-left: 3px solid var(--accent-color);
        }

        .sidebar-menu i {
            margin-right: 10px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .header h2 {
            color: var(--dark-color);
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        /* Cards */
        .cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: var(--light-color);
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .card h3 {
            font-size: 1rem;
            color: #666;
            margin-bottom: 10px;
        }

        .card p {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        .card.total {
            border-top: 3px solid var(--primary-color);
        }

        .card.paid {
            border-top: 3px solid var(--success-color);
        }

        .card.free {
            border-top: 3px solid var(--warning-color);
        }

        /* Tables */
        .table-container {
            background-color: var(--light-color);
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th, table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark-color);
        }

        table tr:hover {
            background-color: #f8f9fa;
        }

        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status.paid {
            background-color: #d4edda;
            color: var(--success-color);
        }

        .status.free {
            background-color: #fff3cd;
            color: var(--warning-color);
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin-right: 5px;
            font-size: 0.8rem;
        }

        .edit-btn {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }

        .delete-btn {
            background-color: var(--danger-color);
            color: var(--light-color);
        }

        /* Form */
        .form-container {
            background-color: var(--light-color);
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        select.form-control {
            height: 40px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--light-color);
        }

        .btn-primary:hover {
            background-color: #3a5a9f;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: var(--light-color);
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            margin-right: 5px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
        }

        .tab.active {
            background-color: var(--light-color);
            border-bottom: 1px solid var(--light-color);
            margin-bottom: -1px;
            color: var(--primary-color);
            font-weight: 500;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Loading indicator */
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        /* Alert messages */
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            border: 1px solid transparent;
        }

        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .alert-danger {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 80px;
                overflow: hidden;
            }
            .sidebar-header h3, .sidebar-menu span {
                display: none;
            }
            .sidebar-menu a {
                text-align: center;
                padding: 10px 5px;
            }
            .sidebar-menu i {
                margin-right: 0;
                font-size: 1.2rem;
            }
            .cards {
                grid-template-columns: 1fr;
            }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 5px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h3>KaboreTech</h3>
        </div>
        <div class="sidebar-menu">
            <ul>
                <li><a href="#" class="active menu-item" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                <li><a href="#" class="menu-item" data-section="videos"><i class="fas fa-video"></i> <span>Vidéos</span></a></li>
                <li><a href="#" class="menu-item" data-section="users"><i class="fas fa-users"></i> <span>Utilisateurs</span></a></li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <h2 id="page-title">Tableau de Bord</h2>
            <div class="user-info">
                <img src="https://via.placeholder.com/40" alt="User">
                <span>Admin</span>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section active">
            <!-- Stats Cards -->
            <div class="cards">
                <div class="card total">
                    <h3>Total Vidéos</h3>
                    <p id="total-videos">0</p>
                </div>
                <div class="card paid">
                    <h3>Vidéos Payantes</h3>
                    <p id="paid-videos">0</p>
                </div>
                <div class="card free">
                    <h3>Vidéos Gratuites</h3>
                    <p id="free-videos">0</p>
                </div>
            </div>

            <div class="table-container">
                <h3>Vidéos Récentes</h3>
                <table id="recent-videos-table">
                    <thead>
                        <tr>
                            <th>Titre</th>
                            <th>Catégorie</th>
                            <th>Partie</th>
                            <th>Type</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="5" class="loading">Chargement des vidéos...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Videos Section -->
        <div id="videos-section" class="section">
            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" data-tab="videos-list">Liste des Vidéos</div>
                <div class="tab" data-tab="add-video">Ajouter une Vidéo</div>
            </div>

            <!-- Videos List Tab -->
            <div class="tab-content active" id="videos-list-tab">
                <div class="table-container">
                    <table id="videos-table">
                        <thead>
                            <tr>
                                <th>Titre</th>
                                <th>Catégorie</th>
                                <th>Partie</th>
                                <th>Type</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="6" class="loading">Chargement des vidéos...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add Video Tab -->
            <div class="tab-content" id="add-video-tab">
                <div class="form-container">
                    <h3 id="video-form-title">Ajouter une Vidéo</h3>
                    <div id="video-alert"></div>
                    <form id="video-form">
                        <div class="form-group">
                            <label for="title">Titre de la vidéo</label>
                            <input type="text" id="title" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="category">Catégorie</label>
                            <select id="category" class="form-control" required>
                                <option value="">Sélectionner une catégorie</option>
                                <option value="Informatique">Informatique</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Bureautique">Bureautique</option>
                                <option value="GSM">GSM</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="part">Partie</label>
                            <input type="text" id="part" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="isPaid">Type de vidéo</label>
                            <select id="isPaid" class="form-control" required>
                                <option value="false">Gratuite</option>
                                <option value="true">Payante</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="description">Description</label>
                            <textarea id="description" class="form-control" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="videoFile">Fichier Vidéo</label>
                            <input type="file" id="videoFile" class="form-control" accept="video/*">
                        </div>
                        <div class="form-group">
                            <label for="imageFile">Image de la vidéo</label>
                            <input type="file" id="imageFile" class="form-control" accept="image/*">
                        </div>
                        <button type="submit" class="btn btn-primary" id="video-submit-btn">Ajouter la Vidéo</button>
                        <button type="button" class="btn btn-secondary" id="cancel-edit-btn" style="display: none;">Annuler</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Users Section -->
        <div id="users-section" class="section">
            <div class="tabs">
                <div class="tab active" data-tab="users-list">Liste des Utilisateurs</div>
                <div class="tab" data-tab="add-user">Ajouter un Utilisateur</div>
            </div>

            <!-- Users List Tab -->
            <div class="tab-content active" id="users-list-tab">
                <div class="table-container">
                    <table id="users-table">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Téléphone</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="4" class="loading">Chargement des utilisateurs...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add User Tab -->
            <div class="tab-content" id="add-user-tab">
                <div class="form-container">
                    <h3>Ajouter un Utilisateur</h3>
                    <div id="user-alert"></div>
                    <form id="user-form">
                        <div class="form-group">
                            <label for="user-name">Nom</label>
                            <input type="text" id="user-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="user-phone">Téléphone</label>
                            <input type="text" id="user-phone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="user-password">Mot de passe</label>
                            <input type="password" id="user-password" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Ajouter l'Utilisateur</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Reset Modal -->
    <div id="password-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Réinitialiser le mot de passe</h3>
            <div id="password-alert"></div>
            <form id="password-form">
                <div class="form-group">
                    <label for="reset-phone">Téléphone</label>
                    <input type="text" id="reset-phone" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label for="reset-otp">Code OTP</label>
                    <input type="text" id="reset-otp" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="reset-new-password">Nouveau mot de passe</label>
                    <input type="password" id="reset-new-password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Réinitialiser</button>
                <button type="button" class="btn btn-secondary" id="send-otp-btn">Envoyer OTP</button>
            </form>
        </div>
    </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
    // Configuration de base
    const BASE_URL = 'https://kaboretech.cursusbf.com';
    let currentVideoId = null;
    let currentUserId = null;

    // Éléments du DOM
    const sections = {
        dashboard: document.getElementById('dashboard-section'),
        videos: document.getElementById('videos-section'),
        users: document.getElementById('users-section')
    };

    const menuItems = document.querySelectorAll('.menu-item');
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const pageTitle = document.getElementById('page-title');

    // Initialisation
    initMenu();
    initTabs();
    loadDashboardData();
    loadVideos();
    loadUsers();

    // Gestion des événements
    document.getElementById('video-form').addEventListener('submit', handleVideoSubmit);
    document.getElementById('user-form').addEventListener('submit', handleUserSubmit);
    document.getElementById('password-form').addEventListener('submit', handlePasswordReset);
    document.getElementById('send-otp-btn').addEventListener('click', sendOTP);
    document.getElementById('cancel-edit-btn').addEventListener('click', cancelEdit);
    document.querySelector('.close').addEventListener('click', closeModal);

    // Fonctions d'initialisation
    function initMenu() {
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                const section = this.getAttribute('data-section');
                
                // Mettre à jour le menu actif
                menuItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                // Afficher la section correspondante
                Object.values(sections).forEach(s => s.classList.remove('active'));
                sections[section].classList.add('active');
                
                // Mettre à jour le titre de la page
                pageTitle.textContent = this.querySelector('span').textContent;
                
                // Charger les données si nécessaire
                if (section === 'dashboard') loadDashboardData();
                if (section === 'videos') loadVideos();
                if (section === 'users') loadUsers();
            });
        });
    }

    function initTabs() {
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Mettre à jour les onglets actifs
                tabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Afficher le contenu correspondant
                tabContents.forEach(c => c.classList.remove('active'));
                document.getElementById(`${tabId}-tab`).classList.add('active');
                
                // Réinitialiser le formulaire si on passe à l'ajout de vidéo
                if (tabId === 'add-video') {
                    resetVideoForm();
                }
            });
        });
    }

    // Fonctions pour le tableau de bord
    function loadDashboardData() {
        fetch(`${BASE_URL}/api/videos`)
            .then(response => response.json())
            .then(data => {
                // Mettre à jour les statistiques
                const totalVideos = data.reduce((acc, category) => acc + category.videos.length, 0);
                const paidVideos = data.reduce((acc, category) => 
                    acc + category.videos.filter(video => video.isPaid).length, 0);
                const freeVideos = totalVideos - paidVideos;
                
                document.getElementById('total-videos').textContent = totalVideos;
                document.getElementById('paid-videos').textContent = paidVideos;
                document.getElementById('free-videos').textContent = freeVideos;
                
                // Mettre à jour le tableau des vidéos récentes
                const recentVideosTable = document.getElementById('recent-videos-table').querySelector('tbody');
                recentVideosTable.innerHTML = '';
                
                // Prendre les 5 premières vidéos de la première catégorie (pour l'exemple)
                if (data.length > 0 && data[0].videos.length > 0) {
                    const videosToShow = data[0].videos.slice(0, 5);
                    
                    videosToShow.forEach(video => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${video.title}</td>
                            <td>${video.categoryId}</td>
                            <td>${video.part}</td>
                            <td><span class="status ${video.isPaid ? 'paid' : 'free'}">${video.isPaid ? 'Payante' : 'Gratuite'}</span></td>
                            <td>
                                <button class="action-btn edit-btn" data-id="${video.id}"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete-btn" data-id="${video.id}"><i class="fas fa-trash"></i></button>
                            </td>
                        `;
                        recentVideosTable.appendChild(row);
                    });
                    
                    // Ajouter les gestionnaires d'événements pour les boutons
                    addVideoActionHandlers();
                } else {
                    recentVideosTable.innerHTML = '<tr><td colspan="5">Aucune vidéo disponible</td></tr>';
                }
            })
            .catch(error => {
                console.error('Erreur lors du chargement du tableau de bord:', error);
                document.getElementById('recent-videos-table').querySelector('tbody').innerHTML = 
                    '<tr><td colspan="5">Erreur lors du chargement des données</td></tr>';
            });
    }

    // Fonctions pour la gestion des vidéos
    function loadVideos() {
        fetch(`${BASE_URL}/api/videos`)
            .then(response => response.json())
            .then(data => {
                const videosTable = document.getElementById('videos-table').querySelector('tbody');
                videosTable.innerHTML = '';
                
                data.forEach(category => {
                    category.videos.forEach(video => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${video.title}</td>
                            <td>${video.categoryId}</td>
                            <td>${video.part}</td>
                            <td><span class="status ${video.isPaid ? 'paid' : 'free'}">${video.isPaid ? 'Payante' : 'Gratuite'}</span></td>
                            <td>${video.details.description.substring(0, 50)}...</td>
                            <td>
                                <button class="action-btn edit-btn" data-id="${video.id}"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete-btn" data-id="${video.id}"><i class="fas fa-trash"></i></button>
                            </td>
                        `;
                        videosTable.appendChild(row);
                    });
                });
                
                if (videosTable.innerHTML === '') {
                    videosTable.innerHTML = '<tr><td colspan="6">Aucune vidéo disponible</td></tr>';
                }
                
                // Ajouter les gestionnaires d'événements pour les boutons
                addVideoActionHandlers();
            })
            .catch(error => {
                console.error('Erreur lors du chargement des vidéos:', error);
                document.getElementById('videos-table').querySelector('tbody').innerHTML = 
                    '<tr><td colspan="6">Erreur lors du chargement des vidéos</td></tr>';
            });
    }

    function addVideoActionHandlers() {
        document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const videoId = this.getAttribute('data-id');
                editVideo(videoId);
            });
        });
        
        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const videoId = this.getAttribute('data-id');
                if (confirm('Êtes-vous sûr de vouloir supprimer cette vidéo ?')) {
                    deleteVideo(videoId);
                }
            });
        });
    }

    function editVideo(videoId) {
        fetch(`${BASE_URL}/api/videos`)
            .then(response => response.json())
            .then(data => {
                let foundVideo = null;
                
                // Rechercher la vidéo dans toutes les catégories
                for (const category of data) {
                    foundVideo = category.videos.find(v => v.id === videoId);
                    if (foundVideo) break;
                }
                
                if (foundVideo) {
                    currentVideoId = videoId;
                    
                    // Remplir le formulaire avec les données de la vidéo
                    document.getElementById('title').value = foundVideo.title;
                    document.getElementById('category').value = foundVideo.categoryId;
                    document.getElementById('part').value = foundVideo.part;
                    document.getElementById('isPaid').value = foundVideo.isPaid.toString();
                    document.getElementById('description').value = foundVideo.details.description;
                    
                    // Mettre à jour le formulaire pour l'édition
                    document.getElementById('video-form-title').textContent = 'Modifier la Vidéo';
                    document.getElementById('video-submit-btn').textContent = 'Mettre à jour';
                    document.getElementById('cancel-edit-btn').style.display = 'inline-block';
                    
                    // Basculer vers l'onglet d'ajout/modification
                    document.querySelector('.tab[data-tab="add-video"]').click();
                } else {
                    showAlert('video-alert', 'Vidéo non trouvée', 'danger');
                }
            })
            .catch(error => {
                console.error('Erreur lors de la récupération de la vidéo:', error);
                showAlert('video-alert', 'Erreur lors de la récupération de la vidéo', 'danger');
            });
    }

    function deleteVideo(videoId) {
        fetch(`${BASE_URL}/api/delete-video/${videoId}`, {
            method: 'DELETE'
        })
        .then(response => {
            if (response.ok) {
                showAlert('video-alert', 'Vidéo supprimée avec succès', 'success');
                loadVideos();
                loadDashboardData();
            } else {
                throw new Error('Erreur lors de la suppression');
            }
        })
        .catch(error => {
            console.error('Erreur lors de la suppression de la vidéo:', error);
            showAlert('video-alert', 'Erreur lors de la suppression de la vidéo', 'danger');
        });
    }

    function handleVideoSubmit(e) {
        e.preventDefault();
        
        const title = document.getElementById('title').value;
        const category = document.getElementById('category').value;
        const part = document.getElementById('part').value;
        const isPaid = document.getElementById('isPaid').value === 'true';
        const description = document.getElementById('description').value;
        const videoFile = document.getElementById('videoFile').files[0];
        const imageFile = document.getElementById('imageFile').files[0];
        
        if (!title || !category || !part || !description) {
            showAlert('video-alert', 'Veuillez remplir tous les champs obligatoires', 'danger');
            return;
        }
        
        const formData = new FormData();
        formData.append('title', title);
        formData.append('categoryId', category);
        formData.append('part', part);
        formData.append('isPaid', isPaid);
        formData.append('description', description);
        if (videoFile) formData.append('videoFile', videoFile);
        if (imageFile) formData.append('imageFile', imageFile);
        
        const url = currentVideoId ? `${BASE_URL}/api/update-video/${currentVideoId}` : `${BASE_URL}/api/add-video`;
        const method = currentVideoId ? 'PUT' : 'POST';
        
        fetch(url, {
            method: method,
            body: formData
        })
        .then(response => {
            if (!response.ok) throw new Error('Erreur lors de la requête');
            return response.json();
        })
        .then(data => {
            const message = currentVideoId ? 'Vidéo mise à jour avec succès' : 'Vidéo ajoutée avec succès';
            showAlert('video-alert', message, 'success');
            
            resetVideoForm();
            loadVideos();
            loadDashboardData();
            
            // Revenir à la liste des vidéos après un délai
            setTimeout(() => {
                document.querySelector('.tab[data-tab="videos-list"]').click();
            }, 1500);
        })
        .catch(error => {
            console.error('Erreur lors de la soumission du formulaire:', error);
            showAlert('video-alert', 'Erreur lors de la soumission du formulaire', 'danger');
        });
    }

    function resetVideoForm() {
        document.getElementById('video-form').reset();
        document.getElementById('video-form-title').textContent = 'Ajouter une Vidéo';
        document.getElementById('video-submit-btn').textContent = 'Ajouter la Vidéo';
        document.getElementById('cancel-edit-btn').style.display = 'none';
        currentVideoId = null;
    }

    function cancelEdit() {
        resetVideoForm();
        document.querySelector('.tab[data-tab="videos-list"]').click();
    }

    // Fonctions pour la gestion des utilisateurs
    function loadUsers() {
        // Note: L'API pour récupérer les utilisateurs n'est pas définie dans votre backend
        // Je suppose qu'il existe une route /api/users
        fetch(`${BASE_URL}/api/users`)
            .then(response => {
                if (!response.ok) throw new Error('Erreur de réseau');
                return response.json();
            })
            .then(users => {
                const usersTable = document.getElementById('users-table').querySelector('tbody');
                usersTable.innerHTML = '';
                
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.name}</td>
                        <td>${user.phone}</td>
                        <td>${getUserStatus(user)}</td>
                        <td>
                            <button class="action-btn edit-btn" data-id="${user._id}"><i class="fas fa-edit"></i></button>
                            <button class="action-btn delete-btn" data-id="${user._id}"><i class="fas fa-trash"></i></button>
                            <button class="action-btn reset-btn" data-id="${user._id}" data-phone="${user.phone}"><i class="fas fa-key"></i></button>
                        </td>
                    `;
                    usersTable.appendChild(row);
                });
                
                if (usersTable.innerHTML === '') {
                    usersTable.innerHTML = '<tr><td colspan="4">Aucun utilisateur disponible</td></tr>';
                }
                
                // Ajouter les gestionnaires d'événements pour les boutons
                addUserActionHandlers();
            })
            .catch(error => {
                console.error('Erreur lors du chargement des utilisateurs:', error);
                document.getElementById('users-table').querySelector('tbody').innerHTML = 
                    '<tr><td colspan="4">Erreur lors du chargement des utilisateurs</td></tr>';
            });
    }

    function getUserStatus(user) {
        const status = [];
        if (user.isInformatiqueHardware) status.push('Info Hardware');
        if (user.isInformatiqueSoftware) status.push('Info Software');
        if (user.isBureautiqueHardware) status.push('Bureautique Hardware');
        if (user.isBureautiqueSoftware) status.push('Bureautique Software');
        if (user.isMarketingSocial) status.push('Marketing Social');
        if (user.isMarketingContent) status.push('Marketing Content');
        if (user.isVIPGsmHardware) status.push('GSM Hardware');
        if (user.isVIPGsmSoftware) status.push('GSM Software');
        
        return status.length > 0 ? status.join(', ') : 'Aucun statut';
    }

    function addUserActionHandlers() {
        document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const userId = this.getAttribute('data-id');
                editUser(userId);
            });
        });
        
        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const userId = this.getAttribute('data-id');
                if (confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?')) {
                    deleteUser(userId);
                }
            });
        });
        
        document.querySelectorAll('.reset-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const phone = this.getAttribute('data-phone');
                openPasswordModal(phone);
            });
        });
    }


    function handleUserSubmit(e) {
        e.preventDefault();
        
        const name = document.getElementById('user-name').value;
        const phone = document.getElementById('user-phone').value;
        const password = document.getElementById('user-password').value;
        
        fetch(`${BASE_URL}/register`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name, phone, password })
        })
        .then(response => {
            if (!response.ok) throw new Error('Erreur lors de la requête');
            return response.json();
        })
        .then(data => {
            showAlert('user-alert', 'Utilisateur ajouté avec succès', 'success');
            document.getElementById('user-form').reset();
            loadUsers();
        })
        .catch(error => {
            console.error('Erreur lors de l\'ajout de l\'utilisateur:', error);
            showAlert('user-alert', 'Erreur lors de l\'ajout de l\'utilisateur', 'danger');
        });
    }

    // Fonctions pour la réinitialisation du mot de passe
    function openPasswordModal(phone) {
        document.getElementById('reset-phone').value = phone;
        document.getElementById('password-modal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('password-modal').style.display = 'none';
        document.getElementById('password-form').reset();
        document.getElementById('password-alert').innerHTML = '';
    }

    function sendOTP() {
        const phone = document.getElementById('reset-phone').value;
        
        fetch(`${BASE_URL}/api/forgot-password`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ phone })
        })
        .then(response => {
            if (!response.ok) throw new Error('Erreur lors de l\'envoi de l\'OTP');
            return response.json();
        })
        .then(data => {
            showAlert('password-alert', 'Code OTP envoyé avec succès', 'success');
        })
        .catch(error => {
            console.error('Erreur lors de l\'envoi de l\'OTP:', error);
            showAlert('password-alert', 'Erreur lors de l\'envoi de l\'OTP', 'danger');
        });
    }

    function handlePasswordReset(e) {
        e.preventDefault();
        
        const phone = document.getElementById('reset-phone').value;
        const otp = document.getElementById('reset-otp').value;
        const newPassword = document.getElementById('reset-new-password').value;
        
        fetch(`${BASE_URL}/api/reset-password`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ phone, otp, newPassword })
        })
        .then(response => {
            if (!response.ok) throw new Error('Erreur lors de la réinitialisation');
            return response.json();
        })
        .then(data => {
            showAlert('password-alert', 'Mot de passe réinitialisé avec succès', 'success');
            setTimeout(closeModal, 1500);
        })
        .catch(error => {
            console.error('Erreur lors de la réinitialisation:', error);
            showAlert('password-alert', 'Erreur lors de la réinitialisation', 'danger');
        });
    }

    // Fonction utilitaire pour afficher les alertes
    function showAlert(elementId, message, type) {
        const alertElement = document.getElementById(elementId);
        alertElement.innerHTML = `
            <div class="alert alert-${type}">
                ${message}
            </div>
        `;
        
        setTimeout(() => {
            alertElement.innerHTML = '';
        }, 5000);
    }
});
  </script>