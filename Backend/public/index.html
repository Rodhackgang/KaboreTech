<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KaboreTech - Admin</title>
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #667eea;
        --primary-dark: #5a6fd8;
        --primary-light: #7c88ee;
        --secondary: #764ba2;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --dark: #1f2937;
        --light: #f9fafb;
        --gray: #6b7280;
        --gray-light: #f3f4f6;
        --border: #e5e7eb;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --gradient-primary: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--secondary) 100%
        );
        --gradient-card: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        color: var(--dark);
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        opacity: 0;
        transition: opacity 0.5s ease;
      }

      body.loaded {
        opacity: 1;
      }

      /* Sidebar */
      .sidebar {
        width: 280px;
        background: var(--dark);
        color: white;
        height: 100vh;
        position: fixed;
        padding: 0;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1000;
        box-shadow: var(--shadow-lg);
      }

      .sidebar-header {
        padding: 30px 25px;
        background: var(--gradient-primary);
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .sidebar-header::before {
        content: "";
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        animation: pulse 4s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 0.3;
        }
        50% {
          transform: scale(1.1) rotate(180deg);
          opacity: 0.1;
        }
      }

      .sidebar-header h3 {
        font-size: 1.8rem;
        font-weight: 700;
        letter-spacing: -0.5px;
        position: relative;
        z-index: 2;
      }

      .sidebar-menu {
        padding: 20px 0;
      }

      .sidebar-menu ul {
        list-style: none;
      }

      .sidebar-menu a {
        display: flex;
        align-items: center;
        padding: 16px 25px;
        color: #d1d5db;
        text-decoration: none;
        font-size: 0.95rem;
        font-weight: 500;
        transition: all 0.3s ease;
        position: relative;
        margin: 4px 15px;
        border-radius: 12px;
      }

      .sidebar-menu a::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        width: 0;
        height: 100%;
        background: var(--gradient-primary);
        border-radius: 12px;
        transition: width 0.3s ease;
        z-index: -1;
      }

      .sidebar-menu a:hover::before,
      .sidebar-menu a.active::before {
        width: 100%;
      }

      .sidebar-menu a:hover,
      .sidebar-menu a.active {
        color: white;
        transform: translateX(8px);
      }

      .sidebar-menu i {
        margin-right: 15px;
        width: 20px;
        text-align: center;
        font-size: 1.1rem;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        margin-left: 280px;
        padding: 30px;
        transition: margin-left 0.3s ease;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 25px 0;
        margin-bottom: 40px;
        background: white;
        border-radius: 20px;
        padding: 25px 30px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
      }

      .header h2 {
        color: var(--dark);
        font-weight: 700;
        font-size: 2rem;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .user-info {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        background: var(--gray-light);
        border-radius: 50px;
        box-shadow: var(--shadow);
      }

      .user-info img {
        border-radius: 50%;
        margin-right: 12px;
        border: 3px solid var(--primary);
      }

      .user-info span {
        font-weight: 600;
        color: var(--dark);
      }

      /* Cards */
      .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
      }

      .card {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        opacity: 0;
        transform: translateY(20px);
        animation: slideInUp 0.8s ease forwards;
      }

      .card:nth-child(1) { animation-delay: 0.1s; }
      .card:nth-child(2) { animation-delay: 0.2s; }
      .card:nth-child(3) { animation-delay: 0.3s; }

      @keyframes slideInUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 6px;
        background: var(--gradient-primary);
      }

      .card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-lg);
      }

      .card.total::before {
        background: var(--gradient-primary);
      }
      .card.paid::before {
        background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
      }
      .card.free::before {
        background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
      }

      .card h3 {
        font-size: 0.9rem;
        color: var(--gray);
        margin-bottom: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .card p {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--dark);
        margin-bottom: 8px;
        font-variant-numeric: tabular-nums;
      }

      .card .trend {
        font-size: 0.85rem;
        color: var(--success);
        display: flex;
        align-items: center;
      }

      /* Table & List */
      .table-container {
        background: white;
        border-radius: 20px;
        box-shadow: var(--shadow);
        padding: 30px;
        margin-bottom: 30px;
        border: 1px solid var(--border);
        opacity: 0;
        transform: translateY(20px);
        animation: slideInUp 0.8s ease 0.4s forwards;
      }

      .table-container h3 {
        margin-bottom: 25px;
        color: var(--dark);
        font-weight: 700;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .table-wrapper {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 800px;
      }

      th {
        background: var(--gray-light);
        padding: 18px 20px;
        text-align: left;
        font-weight: 700;
        color: var(--dark);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: none;
        white-space: nowrap;
      }

      th:first-child {
        border-radius: 12px 0 0 12px;
      }
      th:last-child {
        border-radius: 0 12px 12px 0;
      }

      td {
        padding: 18px 20px;
        border-bottom: 1px solid var(--border);
        font-weight: 500;
      }

      tr {
        transition: background-color 0.2s ease;
      }

      tr:hover {
        background: var(--light);
      }

      tr:last-child td {
        border-bottom: none;
      }

      .status {
        padding: 8px 16px;
        border-radius: 50px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: 2px solid;
        display: inline-block;
      }

      .status.paid {
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        color: var(--success);
        border-color: var(--success);
      }

      .status.free {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        color: var(--warning);
        border-color: var(--warning);
      }

      .action-btn {
        padding: 10px 12px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        margin-right: 8px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        font-weight: 600;
        text-decoration: none;
        display: inline-block;
      }

      .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
      }

      .edit-btn {
        background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
        color: white;
      }

      .delete-btn {
        background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
        color: white;
      }

      .view-btn {
        background: var(--gradient-primary);
        color: white;
      }

      .category-tag {
        background: var(--gray-light);
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        color: var(--gray);
        border: 1px solid var(--border);
      }

      /* Loading States */
      .loading {
        text-align: center;
        color: var(--gray);
        font-style: italic;
        padding: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .loading i {
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }

      .error-state {
        text-align: center;
        color: var(--danger);
        padding: 40px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .retry-btn {
        background: var(--gradient-primary);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .retry-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
      }

      /* Video Thumbnail */
      .video-thumbnail {
        width: 80px;
        height: 45px;
        background: var(--gray-light);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--gray);
        font-size: 1.5rem;
        border: 2px solid var(--border);
        transition: all 0.3s ease;
      }

      .video-thumbnail:hover {
        transform: scale(1.1);
        box-shadow: var(--shadow);
      }

      /* Responsive */
      @media (max-width: 1024px) {
        .sidebar {
          width: 80px;
          overflow: hidden;
        }

        .sidebar-header h3 {
          font-size: 0;
        }

        .sidebar-header h3::after {
          content: "KT";
          font-size: 1.5rem;
        }

        .sidebar-menu span {
          display: none;
        }

        .sidebar-menu i {
          font-size: 1.4rem;
          margin-right: 0;
        }

        .main-content {
          margin-left: 80px;
        }
      }

      @media (max-width: 768px) {
        .main-content {
          margin-left: 0;
          padding: 20px;
        }

        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.mobile-open {
          transform: translateX(0);
        }

        .cards {
          grid-template-columns: 1fr;
        }

        .header {
          flex-direction: column;
          gap: 15px;
        }

        .mobile-menu-toggle {
          display: block !important;
        }
      }

      /* Mobile Menu Toggle */
      .mobile-menu-toggle {
        display: none;
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1001;
        background: var(--gradient-primary);
        border: none;
        padding: 15px;
        border-radius: 12px;
        color: white;
        font-size: 1.2rem;
        cursor: pointer;
        box-shadow: var(--shadow);
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--gray-light);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--gradient-primary);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--primary-dark);
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h3>KaboreTech</h3>
      </div>
      <div class="sidebar-menu">
        <ul>
          <li>
            <a href="#" class="active menu-item" data-section="dashboard">
              <i class="fas fa-tachometer-alt"></i>
              <span>Tableau de Bord</span>
            </a>
          </li>
          <li>
            <a href="#" class="menu-item" data-section="videos">
              <i class="fas fa-video"></i>
              <span>Vidéos</span>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <h2 id="page-title">Tableau de Bord</h2>
        <div class="user-info">
          <img
            src="https://ui-avatars.com/api/?name=Admin&background=667eea&color=fff"
            alt="Admin"
            width="45"
            height="45"
          />
          <span>Administrateur</span>
        </div>
      </div>

      <!-- Dashboard Section -->
      <section id="dashboard-section" class="section active">
        <div class="cards">
          <div class="card total">
            <h3>Total Vidéos</h3>
            <p id="total-videos">0</p>
            <div class="trend">
              <i class="fas fa-arrow-up"></i>
              <span>+12% ce mois</span>
            </div>
          </div>
          <div class="card paid">
            <h3>Vidéos Payantes</h3>
            <p id="paid-videos">0</p>
            <div class="trend">
              <i class="fas fa-arrow-up"></i>
              <span>+8% ce mois</span>
            </div>
          </div>
          <div class="card free">
            <h3>Vidéos Gratuites</h3>
            <p id="free-videos">0</p>
            <div class="trend">
              <i class="fas fa-arrow-up"></i>
              <span>+15% ce mois</span>
            </div>
          </div>
        </div>

        <div class="table-container">
          <h3>
            <i class="fas fa-clock"></i>
            Vidéos Récentes
          </h3>
          <div class="table-wrapper">
            <table id="recent-videos-table">
              <thead>
                <tr>
                  <th>Miniature</th>
                  <th>Titre</th>
                  <th>Catégorie</th>
                  <th>Partie</th>
                  <th>Type</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="6" class="loading">
                    <i class="fas fa-spinner"></i>
                    Chargement des données...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Videos Section -->
      <section id="videos-section" class="section" style="display: none;">
        <div class="table-container">
          <h3>
            <i class="fas fa-video"></i>
            Liste Complète des Vidéos
          </h3>
          <div class="table-wrapper">
            <table id="all-videos-table">
              <thead>
                <tr>
                  <th>Miniature</th>
                  <th>Titre</th>
                  <th>Catégorie</th>
                  <th>Partie</th>
                  <th>Type</th>
                  <th>Description</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="7" class="loading">
                    <i class="fas fa-spinner"></i>
                    Chargement des vidéos...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobile-menu-toggle">
      <i class="fas fa-bars"></i>
    </button>

    <script>
      const API_BASE = "https://kaboretech.cursusbf.com";
      let videosData = [];

      // Initialize the application
      document.addEventListener("DOMContentLoaded", function() {
        initializeApp();
      });

      async function initializeApp() {
        setupEventListeners();
        await loadVideosData();
        updateDashboard();
        setupMobileMenu();
        
        // Add loaded class for smooth appearance
        setTimeout(() => {
          document.body.classList.add("loaded");
        }, 100);
      }

      function setupEventListeners() {
        // Menu navigation
        document.querySelectorAll('.menu-item').forEach(item => {
          item.addEventListener('click', function(e) {
            e.preventDefault();
            const section = this.dataset.section;
            switchSection(section);
          });
        });
      }

      function setupMobileMenu() {
        const toggle = document.getElementById('mobile-menu-toggle');
        const sidebar = document.querySelector('.sidebar');

        toggle.addEventListener('click', () => {
          sidebar.classList.toggle('mobile-open');
        });

        // Close on click outside
        document.addEventListener('click', (e) => {
          if (window.innerWidth <= 768 && 
              !sidebar.contains(e.target) && 
              !toggle.contains(e.target)) {
            sidebar.classList.remove('mobile-open');
          }
        });
      }

      function switchSection(sectionName) {
        // Update active menu item
        document.querySelectorAll('.menu-item').forEach(item => {
          item.classList.remove('active');
        });
        document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');

        // Update page title
        const titles = {
          dashboard: 'Tableau de Bord',
          videos: 'Gestion des Vidéos'
        };
        document.getElementById('page-title').textContent = titles[sectionName];

        // Show/hide sections
        document.querySelectorAll('.section').forEach(section => {
          section.style.display = 'none';
        });
        
        const targetSection = document.getElementById(`${sectionName}-section`);
        targetSection.style.display = 'block';

        // Load section-specific data
        if (sectionName === 'videos' && !targetSection.dataset.loaded) {
          loadAllVideos();
          targetSection.dataset.loaded = 'true';
        }

        // Close mobile menu
        document.querySelector('.sidebar').classList.remove('mobile-open');
      }

      async function loadVideosData() {
        try {
          const response = await fetch(`${API_BASE}/api/videos`);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          
          videosData = await response.json();
          console.log('Données vidéos chargées:', videosData);
        } catch (error) {
          console.error('Erreur lors du chargement des vidéos:', error);
          showErrorState('recent-videos-table', error.message);
        }
      }

      function updateDashboard() {
        if (!videosData || videosData.length === 0) return;

        // Calculate stats
        let totalVideos = 0;
        let paidVideos = 0;
        let freeVideos = 0;
        let allVideos = [];

        videosData.forEach(category => {
          if (category.videos && Array.isArray(category.videos)) {
            category.videos.forEach(video => {
              allVideos.push({
                ...video,
                categoryName: category.name
              });
              totalVideos++;
              if (video.isPaid) {
                paidVideos++;
              } else {
                freeVideos++;
              }
            });
          }
        });

        // Animate counters
        animateCounter('total-videos', totalVideos);
        animateCounter('paid-videos', paidVideos);
        animateCounter('free-videos', freeVideos);

        // Sort videos by ID (newest first - assuming ObjectId format)
        allVideos.sort((a, b) => {
          // Extract timestamp from ObjectId (first 8 characters)
          const timestampA = parseInt(a.id.substring(0, 8), 16);
          const timestampB = parseInt(b.id.substring(0, 8), 16);
          return timestampB - timestampA;
        });

        // Show recent videos (last 10)
        const recentVideos = allVideos.slice(0, 10);
        populateRecentVideosTable(recentVideos);
      }

      function populateRecentVideosTable(videos) {
        const tbody = document.querySelector('#recent-videos-table tbody');
        tbody.innerHTML = '';

        if (videos.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="6" class="loading">
                <i class="fas fa-info-circle"></i>
                Aucune vidéo trouvée
              </td>
            </tr>
          `;
          return;
        }

        videos.forEach(video => {
          const row = createVideoTableRow(video, false);
          tbody.appendChild(row);
        });
      }

      function loadAllVideos() {
        const tbody = document.querySelector('#all-videos-table tbody');
        tbody.innerHTML = '';

        if (!videosData || videosData.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="7" class="loading">
                <i class="fas fa-info-circle"></i>
                Aucune vidéo trouvée
              </td>
            </tr>
          `;
          return;
        }

        let allVideos = [];
        videosData.forEach(category => {
          if (category.videos && Array.isArray(category.videos)) {
            category.videos.forEach(video => {
              allVideos.push({
                ...video,
                categoryName: category.name
              });
            });
          }
        });

        // Sort by date (newest first)
        allVideos.sort((a, b) => {
          const timestampA = parseInt(a.id.substring(0, 8), 16);
          const timestampB = parseInt(b.id.substring(0, 8), 16);
          return timestampB - timestampA;
        });

        allVideos.forEach(video => {
          const row = createVideoTableRow(video, true);
          tbody.appendChild(row);
        });
      }

      function createVideoTableRow(video, showDescription) {
        const tr = document.createElement('tr');
        tr.style.opacity = '0';
        tr.style.transform = 'translateY(20px)';
        
        const description = video.details?.description || 'Pas de description';
        const truncatedDesc = description.length > 80 ? 
          description.substring(0, 80) + '...' : description;

        tr.innerHTML = `
          <td>
            <div class="video-thumbnail" title="Voir la vidéo">
              <i class="fas fa-play"></i>
            </div>
          </td>
          <td style="font-weight: 600; max-width: 200px;">
            <div style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" 
                 title="${video.title}">
              ${video.title}
            </div>
          </td>
          <td>
            <span class="category-tag">${video.categoryName}</span>
          </td>
          <td>
            <span class="category-tag">${video.part}</span>
          </td>
          <td>
            <span class="status ${video.isPaid ? 'paid' : 'free'}">
              ${video.isPaid ? 'Payante' : 'Gratuite'}
            </span>
          </td>
          ${showDescription ? `
            <td style="max-width: 250px;">
              <div style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" 
                   title="${description}">
                ${truncatedDesc}
              </div>
            </td>
          ` : ''}
          <td>
            <button class="action-btn view-btn" onclick="viewVideo('${video.id}')" title="Voir la vidéo">
              <i class="fas fa-eye"></i>
            </button>
            <button class="action-btn edit-btn" onclick="editVideo('${video.id}')" title="Modifier">
              <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn delete-btn" onclick="deleteVideo('${video.id}')" title="Supprimer">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;

        // Animate row appearance
        setTimeout(() => {
          tr.style.transition = 'all 0.5s ease';
          tr.style.opacity = '1';
          tr.style.transform = 'translateY(0)';
        }, Math.random() * 300);

        return tr;
      }

      function animateCounter(elementId, targetValue) {
        const element = document.getElementById(elementId);
        const startValue = parseInt(element.textContent) || 0;
        const duration = 2000;
        const startTime = performance.now();

        function updateCounter(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);

          // Easing function for smooth animation
          const easeOutCubic = 1 - Math.pow(1 - progress, 3);
          const currentValue = Math.round(startValue + (targetValue - startValue) * easeOutCubic);

          element.textContent = currentValue;

          if (progress < 1) {
            requestAnimationFrame(updateCounter);
          }
        }

        requestAnimationFrame(updateCounter);
      }

      function showErrorState(tableId, message) {
        const table = document.getElementById(tableId);
        const tbody = table.querySelector('tbody');
        const colCount = table.querySelector('thead tr').children.length;

        tbody.innerHTML = `
          <tr>
            <td colspan="${colCount}" class="error-state">
              <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: var(--danger);"></i>
              <div>
                <strong>Erreur de chargement</strong>
                <div style="margin-top: 5px; font-size: 0.9rem; color: var(--gray);">
                  ${message}
                </div>
              </div>
              <button class="retry-btn" onclick="retryLoad('${tableId}')">
                <i class="fas fa-redo"></i>
                Réessayer
              </button>
            </td>
          </tr>
        `;
      }

      async function retryLoad(tableId) {
        if (tableId === 'recent-videos-table') {
          // Show loading state
          const tbody = document.querySelector(`#${tableId} tbody`);
          const colCount = document.querySelector(`#${tableId} thead tr`).children.length;
          tbody.innerHTML = `
            <tr>
              <td colspan="${colCount}" class="loading">
                <i class="fas fa-spinner"></i>
                Rechargement des données...
              </td>
            </tr>
          `;
          
          await loadVideosData();
          updateDashboard();
        }
      }

      // Video action functions
      function viewVideo(videoId) {
        const video = findVideoById(videoId);
        if (video && video.details && video.details.video) {
          const videoUrl = `${API_BASE}${video.details.video}`;
          window.open(videoUrl, '_blank');
        } else {
          alert('URL de la vidéo non disponible');
        }
      }

      function editVideo(videoId) {
        const video = findVideoById(videoId);
        if (video) {
          alert(`Fonction d'édition pour la vidéo: "${video.title}"\nID: ${videoId}\n\nCette fonctionnalité sera implémentée prochainement.`);
        }
      }

      function deleteVideo(videoId) {
        const video = findVideoById(videoId);
        if (video && confirm(`Êtes-vous sûr de vouloir supprimer la vidéo "${video.title}" ?\n\nCette action est irréversible.`)) {
          // Show confirmation
          const button = event.target.closest('button');
          const originalContent = button.innerHTML;
          button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
          button.disabled = true;

          // Simulate deletion (replace with actual API call)
          setTimeout(() => {
            alert(`Vidéo "${video.title}" supprimée avec succès.\n\n(Simulation - implémentez l'API de suppression)`);
            button.innerHTML = originalContent;
            button.disabled = false;
            
            // Optionally reload data
            loadVideosData().then(() => {
              updateDashboard();
              if (document.getElementById('videos-section').dataset.loaded) {
                loadAllVideos();
              }
            });
          }, 1500);
        }
      }

      function findVideoById(videoId) {
        for (const category of videosData) {
          if (category.videos) {
            const video = category.videos.find(v => v.id === videoId);
            if (video) {
              return { ...video, categoryName: category.name };
            }
          }
        }
        return null;
      }

      // Utility functions for responsive behavior
      function handleResize() {
        const sidebar = document.querySelector('.sidebar');
        const mobileToggle = document.getElementById('mobile-menu-toggle');
        
        if (window.innerWidth > 768) {
          sidebar.classList.remove('mobile-open');
        }
      }

      window.addEventListener('resize', handleResize);

      // Add smooth scrolling
      document.documentElement.style.scrollBehavior = 'smooth';

      // Add intersection observer for animation triggers
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.animationPlayState = 'running';
          }
        });
      }, observerOptions);

      // Observe all animated elements
      document.querySelectorAll('.card, .table-container').forEach(el => {
        observer.observe(el);
      });

      // Add keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        // Alt + D for Dashboard
        if (e.altKey && e.key === 'd') {
          e.preventDefault();
          switchSection('dashboard');
        }
        // Alt + V for Videos
        if (e.altKey && e.key === 'v') {
          e.preventDefault();
          switchSection('videos');
        }
        // Escape to close mobile menu
        if (e.key === 'Escape') {
          document.querySelector('.sidebar').classList.remove('mobile-open');
        }
      });

      // Add tooltips for better UX
      function addTooltips() {
        const tooltipElements = document.querySelectorAll('[title]');
        tooltipElements.forEach(element => {
          element.addEventListener('mouseenter', function(e) {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = this.getAttribute('title');
            tooltip.style.cssText = `
              position: absolute;
              background: var(--dark);
              color: white;
              padding: 8px 12px;
              border-radius: 6px;
              font-size: 0.8rem;
              white-space: nowrap;
              z-index: 10000;
              pointer-events: none;
              opacity: 0;
              transition: opacity 0.3s ease;
              box-shadow: var(--shadow);
            `;
            
            document.body.appendChild(tooltip);
            
            const rect = this.getBoundingClientRect();
            tooltip.style.left = (rect.left + rect.width / 2 - tooltip.offsetWidth / 2) + 'px';
            tooltip.style.top = (rect.top - tooltip.offsetHeight - 8) + 'px';
            
            setTimeout(() => tooltip.style.opacity = '1', 10);
            
            this.addEventListener('mouseleave', function() {
              tooltip.remove();
            }, { once: true });
          });
        });
      }

      // Initialize tooltips after content loads
      setTimeout(addTooltips, 1000);

      // Add CSS for tooltips
      const tooltipCSS = document.createElement('style');
      tooltipCSS.textContent = `
        .tooltip {
          font-family: inherit !important;
        }
        
        .tooltip::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          border: 4px solid transparent;
          border-top-color: var(--dark);
        }
      `;
      document.head.appendChild(tooltipCSS);

      // Performance optimization: lazy load images
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            if (img.dataset.src) {
              img.src = img.dataset.src;
              img.removeAttribute('data-src');
              imageObserver.unobserve(img);
            }
          }
        });
      });

      // Apply lazy loading to video thumbnails when they become clickable
      document.addEventListener('click', function(e) {
        if (e.target.closest('.video-thumbnail')) {
          const videoId = e.target.closest('tr').querySelector('.view-btn').onclick.toString().match(/'([^']+)'/)[1];
          const video = findVideoById(videoId);
          
          if (video && video.image) {
            const imageUrl = `${API_BASE}${video.image}`;
            // Create a modal or preview window here
            showVideoPreview(video, imageUrl);
          }
        }
      });

      function showVideoPreview(video, imageUrl) {
        // Create a simple preview modal
        const modal = document.createElement('div');
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.8);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 10000;
          backdrop-filter: blur(5px);
        `;

        modal.innerHTML = `
          <div style="
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            text-align: center;
          ">
            <img src="${imageUrl}" alt="${video.title}" style="
              width: 100%;
              max-width: 300px;
              height: auto;
              border-radius: 12px;
              margin-bottom: 20px;
              box-shadow: var(--shadow);
            " onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div style="
              display: none;
              width: 100%;
              height: 200px;
              background: var(--gray-light);
              border-radius: 12px;
              align-items: center;
              justify-content: center;
              color: var(--gray);
              font-size: 3rem;
              margin-bottom: 20px;
            ">
              <i class="fas fa-image"></i>
            </div>
            <h3 style="margin-bottom: 15px; color: var(--dark);">${video.title}</h3>
            <p style="color: var(--gray); margin-bottom: 20px;">${video.details?.description || 'Pas de description'}</p>
            <div style="display: flex; gap: 15px; justify-content: center;">
              <button onclick="viewVideo('${video.id}')" style="
                background: var(--gradient-primary);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                cursor: pointer;
                font-weight: 600;
              ">
                <i class="fas fa-play"></i> Voir la vidéo
              </button>
              <button onclick="this.closest('div[style*=fixed]').remove()" style="
                background: var(--gray);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                cursor: pointer;
                font-weight: 600;
              ">
                <i class="fas fa-times"></i> Fermer
              </button>
            </div>
          </div>
        `;

        document.body.appendChild(modal);

        // Close on outside click
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            modal.remove();
          }
        });

        // Close on escape key
        const escHandler = function(e) {
          if (e.key === 'Escape') {
            modal.remove();
            document.removeEventListener('keydown', escHandler);
          }
        };
        document.addEventListener('keydown', escHandler);
      }

      console.log('KaboreTech Admin Interface chargée avec succès');
    </script>
  </body>
</html>
