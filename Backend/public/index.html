<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KaboreTech - Admin</title>
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --primary-light: #818cf8;
        --secondary: #8b5cf6;
        --accent: #06b6d4;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --dark: #0f172a;
        --gray-900: #1e293b;
        --gray-800: #334155;
        --gray-700: #475569;
        --gray-600: #64748b;
        --gray-500: #94a3b8;
        --gray-400: #cbd5e1;
        --gray-300: #e2e8f0;
        --gray-200: #f1f5f9;
        --gray-100: #f8fafc;
        --white: #ffffff;
        
        --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        --gradient-secondary: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
        --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
        --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        --shadow-md: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        --shadow-xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
        
        --border-radius: 12px;
        --border-radius-lg: 16px;
        --border-radius-xl: 20px;
        
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #f1f5f9 100%);
        color: var(--dark);
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        font-weight: 400;
      }

      /* ==================== LOADER ==================== */
      .app-loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.6s ease, visibility 0.6s ease;
      }

      .app-loader.hide {
        opacity: 0;
        visibility: hidden;
      }

      .loader-content {
        text-align: center;
        color: white;
      }

      .loader-logo {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 2rem;
        animation: pulse 2s infinite;
      }

      .loader-spinner {
        width: 80px;
        height: 80px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 2rem;
      }

      .loader-progress {
        width: 300px;
        height: 6px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50px;
        overflow: hidden;
        margin: 2rem auto;
      }

      .loader-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #ffffff, #e2e8f0);
        border-radius: 50px;
        width: 0%;
        transition: width 0.3s ease;
        position: relative;
      }

      .loader-progress-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.5) 50%, transparent 70%);
        animation: shimmer 1.5s infinite;
      }

      .loader-text {
        font-size: 1.1rem;
        font-weight: 600;
        opacity: 0.9;
        margin-bottom: 1rem;
      }

      .loader-percentage {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
      }

      .loader-status {
        font-size: 0.9rem;
        opacity: 0.7;
        font-weight: 500;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.05); opacity: 0.8; }
      }

      @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }

      /* ==================== SIDEBAR ==================== */
      .sidebar {
        width: 280px;
        background: var(--dark);
        color: white;
        height: 100vh;
        position: fixed;
        padding: 0;
        transition: var(--transition);
        z-index: 1000;
        box-shadow: var(--shadow-xl);
        border-right: 1px solid var(--gray-800);
      }

      .sidebar-header {
        padding: 2rem 1.5rem;
        background: var(--gradient-primary);
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .sidebar-header::before {
        content: "";
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        animation: pulse 4s ease-in-out infinite;
      }

      .sidebar-header h3 {
        font-size: 1.75rem;
        font-weight: 800;
        letter-spacing: -0.5px;
        position: relative;
        z-index: 2;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .sidebar-menu {
        padding: 1.5rem 0;
      }

      .sidebar-menu ul {
        list-style: none;
      }

      .sidebar-menu a {
        display: flex;
        align-items: center;
        padding: 1rem 1.5rem;
        color: var(--gray-400);
        text-decoration: none;
        font-size: 0.95rem;
        font-weight: 500;
        transition: var(--transition);
        position: relative;
        margin: 0.25rem 1rem;
        border-radius: var(--border-radius);
      }

      .sidebar-menu a::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        width: 0;
        height: 100%;
        background: var(--gradient-primary);
        border-radius: var(--border-radius);
        transition: width 0.3s ease;
        z-index: -1;
      }

      .sidebar-menu a:hover::before,
      .sidebar-menu a.active::before {
        width: 100%;
      }

      .sidebar-menu a:hover,
      .sidebar-menu a.active {
        color: white;
        transform: translateX(6px);
      }

      .sidebar-menu i {
        margin-right: 1rem;
        width: 20px;
        text-align: center;
        font-size: 1.1rem;
      }

      /* ==================== MAIN CONTENT ==================== */
      .main-content {
        flex: 1;
        margin-left: 280px;
        padding: 2rem;
        transition: var(--transition);
        min-height: 100vh;
        background: transparent;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 2rem;
        margin-bottom: 2rem;
        background: var(--white);
        border-radius: var(--border-radius-xl);
        box-shadow: var(--shadow-md);
        border: 1px solid var(--gray-200);
        backdrop-filter: blur(20px);
        background: rgba(255, 255, 255, 0.9);
      }

      .header h2 {
        color: var(--dark);
        font-weight: 800;
        font-size: 2.25rem;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -1px;
      }

      .user-info {
        display: flex;
        align-items: center;
        padding: 0.75rem 1.5rem;
        background: var(--gray-100);
        border-radius: 50px;
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-200);
      }

      .user-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        margin-right: 1rem;
        border: 3px solid var(--primary);
        box-shadow: var(--shadow);
      }

      .user-info span {
        font-weight: 600;
        color: var(--dark);
        font-size: 0.95rem;
      }

      /* ==================== CARDS ==================== */
      .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
      }

      .card {
        background: var(--white);
        border-radius: var(--border-radius-xl);
        padding: 2rem;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--gray-200);
        position: relative;
        overflow: hidden;
        transition: var(--transition);
        backdrop-filter: blur(20px);
        background: rgba(255, 255, 255, 0.9);
      }

      .card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 6px;
        background: var(--gradient-primary);
      }

      .card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-xl);
      }

      .card.total::before {
        background: var(--gradient-primary);
      }
      .card.paid::before {
        background: var(--gradient-success);
      }
      .card.free::before {
        background: var(--gradient-warning);
      }

      .card-icon {
        position: absolute;
        top: 2rem;
        right: 2rem;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        opacity: 0.8;
      }

      .card.total .card-icon {
        background: var(--gradient-primary);
      }
      .card.paid .card-icon {
        background: var(--gradient-success);
      }
      .card.free .card-icon {
        background: var(--gradient-warning);
      }

      .card h3 {
        font-size: 0.9rem;
        color: var(--gray-600);
        margin-bottom: 1rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .card p {
        font-size: 3rem;
        font-weight: 900;
        color: var(--dark);
        margin-bottom: 1rem;
        line-height: 1;
      }

      .card .trend {
        font-size: 0.85rem;
        color: var(--success);
        display: flex;
        align-items: center;
        font-weight: 600;
      }

      .card .trend i {
        margin-right: 0.5rem;
        font-size: 0.8rem;
      }

      /* ==================== TABLE CONTAINER ==================== */
      .table-container {
        background: var(--white);
        border-radius: var(--border-radius-xl);
        box-shadow: var(--shadow-md);
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid var(--gray-200);
        backdrop-filter: blur(20px);
        background: rgba(255, 255, 255, 0.95);
      }

      .table-container h3 {
        margin-bottom: 2rem;
        color: var(--dark);
        font-weight: 700;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
      }

      .table-container h3 i {
        margin-right: 0.75rem;
        color: var(--primary);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow);
      }

      th {
        background: var(--gray-100);
        padding: 1.25rem 1.5rem;
        text-align: left;
        font-weight: 700;
        color: var(--dark);
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: none;
      }

      th:first-child {
        border-radius: var(--border-radius) 0 0 0;
      }
      th:last-child {
        border-radius: 0 var(--border-radius) 0 0;
      }

      td {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--gray-200);
        font-weight: 500;
        font-size: 0.9rem;
      }

      tr:hover {
        background: var(--gray-50);
      }

      tr:last-child td {
        border-bottom: none;
      }

      tr:last-child td:first-child {
        border-radius: 0 0 0 var(--border-radius);
      }
      tr:last-child td:last-child {
        border-radius: 0 0 var(--border-radius) 0;
      }

      .status {
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: 2px solid;
      }

      .status.paid {
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        color: var(--success);
        border-color: var(--success);
      }

      .status.free {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        color: var(--warning);
        border-color: var(--warning);
      }

      .category-tag {
        background: var(--primary);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .video-thumbnail {
        width: 50px;
        height: 50px;
        border-radius: var(--border-radius);
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        cursor: pointer;
        transition: var(--transition);
      }

      .video-thumbnail:hover {
        transform: scale(1.1);
        box-shadow: var(--shadow-lg);
      }

      .action-btn {
        padding: 0.75rem;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        margin-right: 0.5rem;
        font-size: 0.9rem;
        transition: var(--transition);
        font-weight: 600;
        width: 40px;
        height: 40px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .view-btn {
        background: var(--gradient-secondary);
        color: white;
      }

      .edit-btn {
        background: var(--gradient-warning);
        color: white;
      }

      .delete-btn {
        background: var(--gradient-danger);
        color: white;
      }

      .reset-btn {
        background: var(--gradient-primary);
        color: white;
      }

      /* ==================== FORMS ==================== */
      .form-container {
        background: var(--white);
        border-radius: var(--border-radius-xl);
        box-shadow: var(--shadow-md);
        padding: 2.5rem;
        border: 1px solid var(--gray-200);
        backdrop-filter: blur(20px);
        background: rgba(255, 255, 255, 0.95);
      }

      .form-container h3 {
        margin-bottom: 2rem;
        color: var(--dark);
        font-weight: 700;
        font-size: 1.75rem;
        display: flex;
        align-items: center;
      }

      .form-container h3 i {
        margin-right: 0.75rem;
        color: var(--primary);
      }

      .form-group {
        margin-bottom: 2rem;
      }

      label {
        display: block;
        margin-bottom: 0.75rem;
        font-weight: 600;
        color: var(--dark);
        font-size: 0.9rem;
        display: flex;
        align-items: center;
      }

      label i {
        margin-right: 0.5rem;
        color: var(--primary);
        width: 16px;
      }

      .form-control {
        width: 100%;
        padding: 1rem 1.25rem;
        border: 2px solid var(--gray-300);
        border-radius: var(--border-radius);
        font-size: 1rem;
        transition: var(--transition);
        background: var(--white);
        font-weight: 500;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        transform: translateY(-2px);
      }

      /* ==================== TABS ==================== */
      .tabs {
        display: flex;
        margin-bottom: 2rem;
        background: var(--gray-200);
        border-radius: var(--border-radius-lg);
        padding: 0.5rem;
        box-shadow: inset var(--shadow);
      }

      .tab {
        padding: 1rem 1.5rem;
        cursor: pointer;
        background: transparent;
        border: none;
        border-radius: var(--border-radius);
        font-weight: 600;
        transition: var(--transition);
        color: var(--gray-600);
        flex: 1;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .tab.active {
        background: var(--white);
        color: var(--primary);
        box-shadow: var(--shadow);
        transform: translateY(-2px);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ==================== UPLOAD PROGRESS ==================== */
      .upload-progress {
        margin-top: 2rem;
        display: none;
        background: var(--gray-100);
        padding: 2rem;
        border-radius: var(--border-radius-lg);
        border: 2px dashed var(--gray-300);
      }

      .progress-bar {
        height: 12px;
        background: var(--gray-300);
        border-radius: 50px;
        overflow: hidden;
        box-shadow: inset var(--shadow);
      }

      .progress-fill {
        height: 100%;
        width: 0%;
        background: var(--gradient-primary);
        transition: width 0.3s ease;
        border-radius: 50px;
        position: relative;
      }

      .progress-fill::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
        animation: shimmer 2s infinite;
      }

      .progress-text {
        font-size: 1rem;
        margin-top: 1rem;
        color: var(--gray-700);
        text-align: center;
        font-weight: 700;
      }

      /* ==================== ALERTS ==================== */
      .alert {
        padding: 1rem 1.5rem;
        margin-bottom: 1.5rem;
        border-radius: var(--border-radius);
        font-size: 0.9rem;
        font-weight: 600;
        border: 2px solid;
        display: flex;
        align-items: center;
        animation: slideIn 0.3s ease;
      }

      .alert i {
        margin-right: 0.75rem;
        font-size: 1.1rem;
      }

      .alert-success {
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        color: var(--success);
        border-color: var(--success);
      }

      .alert-danger {
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        color: var(--danger);
        border-color: var(--danger);
      }

      .alert-info {
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        color: var(--accent);
        border-color: var(--accent);
      }

      /* ==================== MODAL ==================== */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(12px);
      }

      .modal-content {
        background: var(--white);
        padding: 2.5rem;
        border-radius: var(--border-radius-xl);
        width: 90%;
        max-width: 500px;
        box-shadow: var(--shadow-xl);
        border: 1px solid var(--gray-200);
        transform: scale(0.9);
        transition: transform 0.3s ease;
        position: relative;
      }

      .modal.show .modal-content {
        transform: scale(1);
      }

      .close {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        font-size: 1.5rem;
        font-weight: bold;
        cursor: pointer;
        color: var(--gray-500);
        transition: var(--transition);
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background: var(--gray-100);
      }

      .close:hover {
        color: var(--danger);
        background: var(--gray-200);
        transform: rotate(90deg);
      }

      /* ==================== BUTTONS ==================== */
      .btn {
        padding: 1rem 2rem;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 600;
        transition: var(--transition);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        text-decoration: none;
        position: relative;
        overflow: hidden;
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-lg);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-primary {
        background: var(--gradient-primary);
        color: white;
      }

      .btn-secondary {
        background: var(--gradient-secondary);
        color: white;
      }

      .btn-success {
        background: var(--gradient-success);
        color: white;
      }

      .btn-warning {
        background: var(--gradient-warning);
        color: white;
      }

      .btn-danger {
        background: var(--gradient-danger);
        color: white;
      }

      .btn i {
        font-size: 1rem;
      }

      /* ==================== LOADING STATES ==================== */
      .loading {
        text-align: center;
        color: var(--gray-500);
        font-style: italic;
        padding: 3rem;
        background: var(--gray-50);
        border-radius: var(--border-radius);
      }

      .loading i {
        font-size: 2rem;
        margin-bottom: 1rem;
        display: block;
        color: var(--primary);
        animation: spin 2s linear infinite;
      }

      .error-state {
        text-align: center;
        color: var(--danger);
        padding: 3rem;
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        border-radius: var(--border-radius);
        border: 2px dashed var(--danger);
      }

      .error-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        display: block;
      }

      /* ==================== RESPONSIVE ==================== */
      @media (max-width: 1024px) {
        .sidebar {
          width: 80px;
          overflow: hidden;
        }

        .sidebar-header h3 {
          font-size: 0;
        }

        .sidebar-header h3::after {
          content: "KT";
          font-size: 1.5rem;
        }

        .sidebar-menu span {
          display: none;
        }

        .sidebar-menu i {
          font-size: 1.4rem;
          margin-right: 0;
        }

        .main-content {
          margin-left: 80px;
        }
      }

      @media (max-width: 768px) {
        .main-content {
          margin-left: 0;
          padding: 1rem;
        }

        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.mobile-open {
          transform: translateX(0);
        }

        .cards {
          grid-template-columns: 1fr;
          gap: 1rem;
        }

        .header {
          flex-direction: column;
          gap: 1rem;
          padding: 1.5rem;
        }

        .header h2 {
          font-size: 1.75rem;
        }

        .table-container {
          overflow-x: auto;
          padding: 1rem;
        }

        .form-container {
          padding: 1.5rem;
        }

        .modal-content {
          margin: 1rem;
          padding: 1.5rem;
        }

        .btn {
          padding: 0.75rem 1.5rem;
          font-size: 0.85rem;
        }
      }

      @media (max-width: 480px) {
        .main-content {
          padding: 0.5rem;
        }

        .card p {
          font-size: 2rem;
        }

        .table-container h3 {
          font-size: 1.25rem;
        }
      }

      /* ==================== CUSTOM SCROLLBAR ==================== */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--gray-200);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--gradient-primary);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--primary-dark);
      }

      /* ==================== ANIMATIONS ==================== */
      .slide-in {
        animation: slideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .bounce {
        animation: bounce 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-12px);
        }
        60% {
          transform: translateY(-6px);
        }
      }

      .fade-in {
        animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ==================== MOBILE MENU TOGGLE ==================== */
      .mobile-menu-toggle {
        display: none;
        position: fixed;
        top: 1rem;
        left: 1rem;
        z-index: 1001;
        background: var(--gradient-primary);
        border: none;
        padding: 1rem;
        border-radius: var(--border-radius);
        color: white;
        font-size: 1.25rem;
        box-shadow: var(--shadow-lg);
        transition: var(--transition);
      }

      .mobile-menu-toggle:hover {
        transform: scale(1.1);
      }

      /* ==================== THEME TOGGLE ==================== */
      .theme-toggle {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        width: 60px;
        height: 60px;
        border: none;
        border-radius: 50%;
        background: var(--gradient-primary);
        color: white;
        cursor: pointer;
        z-index: 1000;
        font-size: 1.5rem;
        box-shadow: var(--shadow-xl);
        transition: var(--transition);
      }

      .theme-toggle:hover {
        transform: scale(1.1) rotate(15deg);
      }

      /* ==================== ENHANCED STATES ==================== */
      .section {
        display: none;
      }

      .section.active {
        display: block;
        animation: fadeIn 0.5s ease;
      }

      .card.loading {
        position: relative;
      }

      .card.loading::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
        animation: shimmer 1.5s infinite;
      }

      .tooltip {
        position: absolute;
        background: var(--dark);
        color: white;
        padding: 0.5rem 0.75rem;
        border-radius: var(--border-radius);
        font-size: 0.75rem;
        font-weight: 500;
        z-index: 10000;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
        box-shadow: var(--shadow-lg);
        white-space: nowrap;
      }

      .tooltip::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-top: 5px solid var(--dark);
      }

      /* ==================== ENHANCED FOCUS STATES ==================== */
      *:focus-visible {
        outline: 2px solid var(--primary);
        outline-offset: 2px;
      }

      .btn:focus-visible {
        outline: none;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
      }
    </style>
  </head>
  <body>
    <!-- App Loader -->
    <div class="app-loader" id="appLoader">
      <div class="loader-content">
        <div class="loader-logo">
          <i class="fas fa-code"></i>
          KaboreTech
        </div>
        <div class="loader-spinner"></div>
        <div class="loader-text">Chargement des données...</div>
        <div class="loader-progress">
          <div class="loader-progress-bar" id="loaderProgressBar"></div>
        </div>
        <div class="loader-percentage" id="loaderPercentage">0%</div>
        <div class="loader-status" id="loaderStatus">Initialisation...</div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h3>KaboreTech</h3>
      </div>
      <div class="sidebar-menu">
        <ul>
          <li>
            <a href="#" class="active menu-item" data-section="dashboard">
              <i class="fas fa-tachometer-alt"></i>
              <span>Tableau de Bord</span>
            </a>
          </li>
          <li>
            <a href="#" class="menu-item" data-section="videos">
              <i class="fas fa-video"></i>
              <span>Gestion Vidéos</span>
            </a>
          </li>
          <li>
            <a href="#" class="menu-item" data-section="users">
              <i class="fas fa-users"></i>
              <span>Utilisateurs</span>
            </a>
          </li>
          <li>
            <a href="#" class="menu-item" data-section="settings">
              <i class="fas fa-cog"></i>
              <span>Paramètres</span>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <h2 id="page-title">Tableau de Bord</h2>
        <div class="user-info">
          <img
            src="https://ui-avatars.com/api/?name=Admin&background=667eea&color=fff&size=48"
            alt="Admin"
            class="user-avatar"
          />
          <span>Administrateur</span>
        </div>
      </div>

      <!-- Dashboard Section -->
      <section id="dashboard-section" class="section active slide-in">
        <div class="cards">
          <div class="card total bounce">
            <div class="card-icon">
              <i class="fas fa-video"></i>
            </div>
            <h3>Total Vidéos</h3>
            <p id="total-videos">0</p>
            <div class="trend">
              <i class="fas fa-arrow-up"></i>
              <span>+12% ce mois</span>
            </div>
          </div>
          <div class="card paid bounce" style="animation-delay: 0.1s">
            <div class="card-icon">
              <i class="fas fa-crown"></i>
            </div>
            <h3>Vidéos Payantes</h3>
            <p id="paid-videos">0</p>
            <div class="trend">
              <i class="fas fa-arrow-up"></i>
              <span>+8% ce mois</span>
            </div>
          </div>
          <div class="card free bounce" style="animation-delay: 0.2s">
            <div class="card-icon">
              <i class="fas fa-gift"></i>
            </div>
            <h3>Vidéos Gratuites</h3>
            <p id="free-videos">0</p>
            <div class="trend">
              <i class="fas fa-arrow-up"></i>
              <span>+15% ce mois</span>
            </div>
          </div>
        </div>

        <div class="table-container fade-in">
          <h3>
            <i class="fas fa-clock"></i>
            Vidéos Récentes
          </h3>
          <table id="recent-videos-table">
            <thead>
              <tr>
                <th>Aperçu</th>
                <th>Titre</th>
                <th>Catégorie</th>
                <th>Partie</th>
                <th>Type</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="6" class="loading">
                  <i class="fas fa-spinner fa-spin"></i>
                  Chargement des données...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Videos Section -->
      <section id="videos-section" class="section">
        <div class="tabs">
          <button class="tab active" data-tab="add-video">
            <i class="fas fa-plus"></i>
            Ajouter une Vidéo
          </button>
          <button class="tab" data-tab="videos-list">
            <i class="fas fa-list"></i>
            Toutes les Vidéos
          </button>
        </div>

        <!-- Add Video Tab -->
        <div class="tab-content active" id="add-video-tab">
          <div class="form-container">
            <h3 id="video-form-title">
              <i class="fas fa-video"></i>
              Ajouter une Vidéo
            </h3>
            <div id="video-alert"></div>
            
            <form id="video-form">
              <div class="form-group">
                <label for="title">
                  <i class="fas fa-heading"></i>
                  Titre
                </label>
                <input
                  type="text"
                  id="title"
                  class="form-control"
                  required
                  placeholder="Entrez le titre de la vidéo"
                />
              </div>

              <div class="form-group">
                <label for="isPaid">
                  <i class="fas fa-tag"></i>
                  Type
                </label>
                <select id="isPaid" class="form-control" required>
                  <option value="false">Gratuite</option>
                  <option value="true">Payante</option>
                </select>
              </div>

              <div id="category-group">
                <div class="form-group">
                  <label for="category">
                    <i class="fas fa-folder"></i>
                    Catégorie
                  </label>
                  <select id="category" class="form-control" required>
                    <option value="">Sélectionner une catégorie</option>
                    <option value="Informatique">Maintenance Informatique</option>
                    <option value="Marketing">Marketing Digital</option>
                    <option value="Bureautique">Secrétariat Informatique</option>
                    <option value="GSM">Réparation Téléphone</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="part">
                    <i class="fas fa-puzzle-piece"></i>
                    Partie
                  </label>
                  <select id="part" class="form-control" required>
                    <option value="">Sélectionner une partie</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label for="description">
                  <i class="fas fa-align-left"></i>
                  Description
                </label>
                <textarea
                  id="description"
                  class="form-control"
                  rows="4"
                  required
                  placeholder="Décrivez votre vidéo..."
                ></textarea>
              </div>

              <div class="form-group">
                <label for="videoFile">
                  <i class="fas fa-film"></i>
                  Fichier Vidéo
                </label>
                <input
                  type="file"
                  id="videoFile"
                  class="form-control"
                  accept="video/*"
                />
              </div>

              <div class="form-group">
                <label for="imageFile">
                  <i class="fas fa-image"></i>
                  Image de Couverture
                </label>
                <input
                  type="file"
                  id="imageFile"
                  class="form-control"
                  accept="image/*"
                />
              </div>

              <div class="upload-progress" id="uploadProgress">
                <div class="progress-bar">
                  <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text" id="progress-text">Téléchargement: 0%</div>
              </div>

              <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap">
                <button type="submit" class="btn btn-primary" id="video-submit-btn">
                  <i class="fas fa-save"></i>
                  Ajouter la Vidéo
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  id="cancel-edit-btn"
                  style="display: none"
                >
                  <i class="fas fa-times"></i>
                  Annuler
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Videos List Tab -->
        <div class="tab-content" id="videos-list-tab">
          <div class="table-container">
            <h3>
              <i class="fas fa-video"></i>
              Toutes les Vidéos
            </h3>
            <table id="all-videos-table">
              <thead>
                <tr>
                  <th>Aperçu</th>
                  <th>Titre</th>
                  <th>Catégorie</th>
                  <th>Partie</th>
                  <th>Type</th>
                  <th>Description</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="7" class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    Chargement des vidéos...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Users Section -->
      <section id="users-section" class="section">
        <div class="tabs">
          <button class="tab active" data-tab="add-user">
            <i class="fas fa-user-plus"></i>
            Ajouter Utilisateur
          </button>
          <button class="tab" data-tab="users-list">
            <i class="fas fa-users"></i>
            Liste des Utilisateurs
          </button>
        </div>

        <!-- Add User Tab -->
        <div class="tab-content active" id="add-user-tab">
          <div class="form-container">
            <h3>
              <i class="fas fa-user-plus"></i>
              Ajouter un Utilisateur
            </h3>
            <div id="user-alert"></div>
            
            <form id="user-form">
              <div class="form-group">
                <label for="user-name">
                  <i class="fas fa-user"></i>
                  Nom Complet
                </label>
                <input
                  type="text"
                  id="user-name"
                  class="form-control"
                  required
                  placeholder="Nom et prénom"
                />
              </div>
              
              <div class="form-group">
                <label for="user-phone">
                  <i class="fas fa-phone"></i>
                  Téléphone
                </label>
                <input
                  type="text"
                  id="user-phone"
                  class="form-control"
                  placeholder="+226 XX XX XX XX"
                  required
                />
              </div>
              
              <div class="form-group">
                <label for="user-password">
                  <i class="fas fa-lock"></i>
                  Mot de passe
                </label>
                <input
                  type="password"
                  id="user-password"
                  class="form-control"
                  required
                  placeholder="Mot de passe sécurisé"
                />
              </div>
              
              <button type="submit" class="btn btn-success">
                <i class="fas fa-user-plus"></i>
                Ajouter Utilisateur
              </button>
            </form>
          </div>
        </div>

        <!-- Users List Tab -->
        <div class="tab-content" id="users-list-tab">
          <div class="table-container">
            <h3>
              <i class="fas fa-users"></i>
              Liste des Utilisateurs
            </h3>
            <table id="users-table">
              <thead>
                <tr>
                  <th>Utilisateur</th>
                  <th>Téléphone</th>
                  <th>Statut</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="4" class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    Chargement des utilisateurs...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="settings-section" class="section">
        <div class="form-container">
          <h3>
            <i class="fas fa-cog"></i>
            Paramètres du Système
          </h3>
          <div id="settings-alert"></div>
          
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 1rem; cursor: pointer; padding: 1rem; background: var(--gray-100); border-radius: var(--border-radius); border: 2px solid var(--gray-300); transition: var(--transition);">
              <input
                type="checkbox"
                id="screen-capture-toggle"
                style="transform: scale(1.8); accent-color: var(--primary);"
              />
              <div style="flex: 1;">
                <div style="font-weight: 600; color: var(--dark); margin-bottom: 0.25rem;">
                  <i class="fas fa-camera" style="margin-right: 0.5rem; color: var(--primary);"></i>
                  Autoriser la capture d'écran
                </div>
                <small style="color: var(--gray-600);">
                  Permet aux utilisateurs de faire des captures d'écran de l'application
                </small>
              </div>
            </label>
          </div>
        </div>
      </section>
    </div>

    <!-- Reset Password Modal -->
    <div id="password-modal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeModal">
          <i class="fas fa-times"></i>
        </span>
        <h3 style="margin-bottom: 2rem; display: flex; align-items: center;">
          <i class="fas fa-key" style="margin-right: 0.75rem; color: var(--primary);"></i>
          Réinitialiser le mot de passe
        </h3>
        <div id="password-alert"></div>
        
        <form id="password-form">
          <div class="form-group">
            <label for="reset-phone">
              <i class="fas fa-phone"></i>
              Téléphone
            </label>
            <input type="text" id="reset-phone" class="form-control" readonly />
          </div>
          
          <div class="form-group">
            <label for="reset-otp">
              <i class="fas fa-shield-alt"></i>
              Code OTP
            </label>
            <input
              type="text"
              id="reset-otp"
              class="form-control"
              required
              placeholder="Entrez le code OTP"
            />
          </div>
          
          <div class="form-group">
            <label for="reset-new-password">
              <i class="fas fa-lock"></i>
              Nouveau mot de passe
            </label>
            <input
              type="password"
              id="reset-new-password"
              class="form-control"
              required
              placeholder="Nouveau mot de passe"
            />
          </div>
          
          <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
            <button type="submit" class="btn btn-success">
              <i class="fas fa-check"></i>
              Réinitialiser
            </button>
            <button type="button" class="btn btn-warning" id="send-otp-btn">
              <i class="fas fa-paper-plane"></i>
              Envoyer OTP
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle" style="display: none;">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Theme Toggle -->
    <button class="theme-toggle" id="themeToggle">
      <i class="fas fa-moon"></i>
    </button>

    <script>
      const API_BASE = "https://kaboretech.cursusbf.com";
      let videosData = [];
      let currentVideoId = null;
      let loadingProgress = 0;

      // Mapping Catégorie → Parties
      const partOptions = {
        Informatique: ["Hardware", "Software"],
        Marketing: ["Social", "Content"],
        Bureautique: ["Partie1", "Partie2"],
        GSM: ["Hardware", "Software"],
      };

      // Catégories gratuites aléatoires
      const freeCategories = Object.keys(partOptions);
      const getRandomCategory = () =>
        freeCategories[Math.floor(Math.random() * freeCategories.length)];
      const getRandomPart = (cat) =>
        partOptions[cat][Math.floor(Math.random() * partOptions[cat].length)];

      // ==================== LOADER MANAGEMENT ====================
      function updateLoader(percentage, status) {
        const progressBar = document.getElementById('loaderProgressBar');
        const percentageEl = document.getElementById('loaderPercentage');
        const statusEl = document.getElementById('loaderStatus');
        
        if (progressBar) progressBar.style.width = percentage + '%';
        if (percentageEl) percentageEl.textContent = percentage + '%';
        if (statusEl) statusEl.textContent = status;
      }

      function hideLoader() {
        const loader = document.getElementById('appLoader');
        setTimeout(() => {
          loader.classList.add('hide');
          setTimeout(() => {
            loader.style.display = 'none';
          }, 600);
        }, 500);
      }

      async function simulateLoading() {
        const steps = [
          { progress: 10, status: 'Initialisation du système...' },
          { progress: 25, status: 'Connexion au serveur...' },
          { progress: 40, status: 'Chargement des vidéos...' },
          { progress: 60, status: 'Récupération des utilisateurs...' },
          { progress: 80, status: 'Configuration des paramètres...' },
          { progress: 95, status: 'Finalisation...' },
          { progress: 100, status: 'Prêt !' }
        ];

        for (let step of steps) {
          await new Promise(resolve => setTimeout(resolve, 300));
          updateLoader(step.progress, step.status);
        }

        await new Promise(resolve => setTimeout(resolve, 500));
        hideLoader();
      }

      // ==================== INITIALIZATION ====================
      document.addEventListener("DOMContentLoaded", async () => {
        // Start loading simulation
        simulateLoading();
        
        // Initialize app components
        await initializeApp();
        await loadVideosData();
        loadUsers();
        loadScreenCaptureSetting();
        setupTabs();
        setupEventListeners();
        setupMobileMenu();
        setupThemeToggle();
        setupTooltips();
      });

      async function initializeApp() {
        // Animation d'apparition
        setTimeout(() => document.body.classList.add("loaded"), 100);
        
        // Setup responsive behavior
        handleResize();
        window.addEventListener('resize', handleResize);
      }

      function handleResize() {
        const toggle = document.getElementById('mobileMenuToggle');
        if (window.innerWidth <= 768) {
          toggle.style.display = 'block';
        } else {
          toggle.style.display = 'none';
          document.querySelector('.sidebar').classList.remove('mobile-open');
        }
      }

      function setupEventListeners() {
        // Navigation menu
        document.querySelectorAll(".menu-item").forEach((item) => {
          item.addEventListener("click", (e) => {
            e.preventDefault();
            const section = item.dataset.section;
            switchSection(section);
          });
        });

        // Forms
        document
          .getElementById("isPaid")
          ?.addEventListener("change", toggleCategoryGroup);
        document
          .getElementById("category")
          ?.addEventListener("change", updatePartOptions);
        document
          .getElementById("video-form")
          ?.addEventListener("submit", handleVideoSubmit);
        document
          .getElementById("user-form")
          ?.addEventListener("submit", handleUserSubmit);
        document
          .getElementById("password-form")
          ?.addEventListener("submit", handlePasswordReset);
        document
          .getElementById("send-otp-btn")
          ?.addEventListener("click", sendOTP);
        document
          .getElementById("screen-capture-toggle")
          ?.addEventListener("change", toggleScreenCapture);
        document
          .getElementById("cancel-edit-btn")
          ?.addEventListener("click", cancelEdit);
        document
          .getElementById("closeModal")
          ?.addEventListener("click", closeModal);
      }

      function setupMobileMenu() {
        const toggle = document.getElementById("mobileMenuToggle");
        const sidebar = document.querySelector(".sidebar");

        toggle?.addEventListener("click", () => {
          sidebar.classList.toggle("mobile-open");
        });

        document.addEventListener("click", (e) => {
          if (
            window.innerWidth <= 768 &&
            !sidebar.contains(e.target) &&
            !toggle?.contains(e.target)
          ) {
            sidebar.classList.remove("mobile-open");
          }
        });
      }

      function setupThemeToggle() {
        const toggle = document.getElementById("themeToggle");
        
        toggle?.addEventListener("click", () => {
          document.body.classList.toggle("dark-theme");
          const icon = toggle.querySelector("i");
          
          if (document.body.classList.contains("dark-theme")) {
            icon.className = "fas fa-sun";
            localStorage.setItem('theme', 'dark');
          } else {
            icon.className = "fas fa-moon";
            localStorage.setItem('theme', 'light');
          }
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
          document.body.classList.add('dark-theme');
          toggle.querySelector('i').className = 'fas fa-sun';
        }
      }

      function switchSection(sectionName) {
        // Update active menu item
        document
          .querySelectorAll(".menu-item")
          .forEach((item) => item.classList.remove("active"));
        document
          .querySelector(`[data-section="${sectionName}"]`)
          ?.classList.add("active");

        // Update page title
        const titles = {
          dashboard: "Tableau de Bord",
          videos: "Gestion des Vidéos",
          users: "Gestion des Utilisateurs",
          settings: "Paramètres du Système",
        };
        document.getElementById("page-title").textContent = titles[sectionName];

        // Show selected section
        document
          .querySelectorAll(".section")
          .forEach((s) => s.classList.remove("active"));
        const targetSection = document.getElementById(`${sectionName}-section`);
        targetSection.classList.add("active");

        // Load section-specific data
        if (sectionName === "videos") {
          if (!document.getElementById("videos-section").dataset.loaded) {
            loadAllVideos();
            document.getElementById("videos-section").dataset.loaded = "true";
          }
        }

        if (sectionName === "users") loadUsers();
        if (sectionName === "settings") loadScreenCaptureSetting();

        // Close mobile sidebar
        document.querySelector(".sidebar").classList.remove("mobile-open");
      }

      // ==================== VIDEO MANAGEMENT ====================
      async function loadVideosData() {
        try {
          updateLoader(40, 'Chargement des vidéos...');
          
          const res = await fetch(`${API_BASE}/api/videos`);
          if (!res.ok) throw new Error(`Échec du chargement: ${res.status}`);
          
          videosData = await res.json();
          updateDashboard();
          
          updateLoader(60, 'Vidéos chargées avec succès');
        } catch (error) {
          console.error("Erreur:", error);
          showErrorState("recent-videos-table", error.message);
          updateLoader(60, 'Erreur lors du chargement des vidéos');
        }
      }

      function updateDashboard() {
        if (!videosData || videosData.length === 0) return;

        let total = 0, paid = 0, free = 0;
        const allVideos = [];

        videosData.forEach((cat) => {
          if (cat.videos && Array.isArray(cat.videos)) {
            cat.videos.forEach((v) => {
              allVideos.push({ ...v, categoryName: cat.name });
              total++;
              v.isPaid ? paid++ : free++;
            });
          }
        });

        // Animate counters
        animateCounter("total-videos", total);
        animateCounter("paid-videos", paid);
        animateCounter("free-videos", free);

        // Sort by newest first
        allVideos.sort(
          (a, b) =>
            parseInt(b.id.substring(0, 8), 16) -
            parseInt(a.id.substring(0, 8), 16)
        );
        
        populateRecentVideosTable(allVideos.slice(0, 10));
      }

      function populateRecentVideosTable(videos) {
        const tbody = document.querySelector("#recent-videos-table tbody");
        tbody.innerHTML = "";

        if (videos.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="6" class="loading">
                <i class="fas fa-info-circle"></i>
                Aucune vidéo disponible
              </td>
            </tr>`;
          return;
        }

        videos.forEach((video, index) => {
          const row = createVideoTableRow(video, false);
          tbody.appendChild(row);
          
          // Animate row appearance
          setTimeout(() => {
            row.style.opacity = "1";
            row.style.transform = "translateY(0)";
          }, index * 100);
        });
      }

      function createVideoTableRow(video, showDescription = false) {
        const tr = document.createElement("tr");
        tr.style.opacity = "0";
        tr.style.transform = "translateY(20px)";
        tr.style.transition = "all 0.5s ease";

        const desc = video.details?.description || "Pas de description";
        const truncated = desc.length > 80 ? desc.substring(0, 80) + "..." : desc;

        tr.innerHTML = `
          <td>
            <div class="video-thumbnail" onclick="viewVideo('${video.id}')" title="Voir la vidéo">
              <i class="fas fa-play"></i>
            </div>
          </td>
          <td style="font-weight:600; max-width: 200px;" title="${video.title}">
            ${video.title.length > 30 ? video.title.substring(0, 30) + '...' : video.title}
          </td>
          <td><span class="category-tag">${video.categoryName}</span></td>
          <td><span class="category-tag" style="background: var(--secondary);">${video.part}</span></td>
          <td>
            <span class="status ${video.isPaid ? "paid" : "free"}">
              ${video.isPaid ? "Payante" : "Gratuite"}
            </span>
          </td>
          ${showDescription ? `<td style="max-width:250px" title="${desc}">${truncated}</td>` : ""}
          <td>
            <button class="action-btn view-btn" onclick="viewVideo('${video.id}')" title="Voir">
              <i class="fas fa-eye"></i>
            </button>
            <button class="action-btn edit-btn" data-id="${video.id}" title="Modifier">
              <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn delete-btn" data-id="${video.id}" title="Supprimer">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;

        return tr;
      }

      function loadAllVideos() {
        const tbody = document.querySelector("#all-videos-table tbody");
        tbody.innerHTML = "";

        if (!videosData || videosData.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="7" class="loading">
                <i class="fas fa-info-circle"></i>
                Aucune vidéo disponible
              </td>
            </tr>`;
          return;
        }

        const allVideos = [];
        videosData.forEach((cat) => {
          if (cat.videos && Array.isArray(cat.videos)) {
            cat.videos.forEach((v) =>
              allVideos.push({ ...v, categoryName: cat.name })
            );
          }
        });

        allVideos.sort(
          (a, b) =>
            parseInt(b.id.substring(0, 8), 16) -
            parseInt(a.id.substring(0, 8), 16)
        );

        allVideos.forEach((video, index) => {
          const row = createVideoTableRow(video, true);
          tbody.appendChild(row);
          
          // Animate row appearance
          setTimeout(() => {
            row.style.opacity = "1";
            row.style.transform = "translateY(0)";
          }, index * 50);
        });

        addVideoActionHandlers();
      }

      function addVideoActionHandlers() {
        document.querySelectorAll(".edit-btn").forEach((btn) => {
          btn.addEventListener("click", (e) =>
            editVideo(e.target.closest("button").dataset.id)
          );
        });

        document.querySelectorAll(".delete-btn").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            const videoTitle = e.target.closest('tr').children[1].textContent.trim();
            if (confirm(`Supprimer la vidéo "${videoTitle}" ?\nCette action est irréversible.`)) {
              deleteVideo(e.target.closest("button").dataset.id);
            }
          });
        });
      }

      async function deleteVideo(id) {
        const btn = document.querySelector(`button[data-id="${id}"].delete-btn`);
        const originalContent = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        btn.disabled = true;

        try {
          const res = await fetch(`${API_BASE}/api/videos/${id}`, {
            method: "DELETE",
          });
          
          if (res.ok) {
            showAlert("video-alert", '<i class="fas fa-check-circle"></i> Vidéo supprimée avec succès', "success");
            await loadVideosData();
            loadAllVideos();
            
            // Remove the row with animation
            const row = btn.closest('tr');
            row.style.opacity = '0';
            row.style.transform = 'translateX(-100%)';
            setTimeout(() => row.remove(), 300);
          } else {
            throw new Error("Échec de suppression");
          }
        } catch (e) {
          showAlert("video-alert", `<i class="fas fa-exclamation-triangle"></i> ${e.message}`, "danger");
          btn.innerHTML = originalContent;
          btn.disabled = false;
        }
      }

      async function editVideo(id) {
        let video = null;
        for (const cat of videosData) {
          video = cat.videos?.find((v) => v.id === id);
          if (video) break;
        }
        if (!video) return;

        currentVideoId = id;
        document.getElementById("title").value = video.title;
        document.getElementById("isPaid").value = video.isPaid.toString();
        document.getElementById("category").value = video.categoryId || "";
        updatePartOptions();
        document.getElementById("part").value = video.part || "";
        document.getElementById("description").value = video.details?.description || "";

        document.getElementById("video-form-title").innerHTML =
          '<i class="fas fa-edit"></i> Modifier la Vidéo';
        document.getElementById("video-submit-btn").innerHTML =
          '<i class="fas fa-save"></i> Mettre à jour';
        document.getElementById("cancel-edit-btn").style.display = "inline-flex";
        document.getElementById("category-group").style.display = "block";

        switchSection("videos");
        document.querySelector('.tab[data-tab="add-video"]')?.click();
        showAlert("video-alert", '<i class="fas fa-info-circle"></i> Mode édition activé', "info");
      }

      async function handleVideoSubmit(e) {
        e.preventDefault();
        const btn = document.getElementById("video-submit-btn");
        const original = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Traitement...';
        btn.disabled = true;

        try {
          const formData = new FormData();
          formData.append("title", document.getElementById("title").value);
          formData.append("isPaid", document.getElementById("isPaid").value);
          formData.append("description", document.getElementById("description").value);

          const isPaid = document.getElementById("isPaid").value === "true";
          if (isPaid) {
            formData.append("categoryId", document.getElementById("category").value);
            formData.append("part", document.getElementById("part").value);
          } else {
            const cat = getRandomCategory();
            formData.append("categoryId", cat);
            formData.append("part", getRandomPart(cat));
          }

          const videoFile = document.getElementById("videoFile").files[0];
          const imageFile = document.getElementById("imageFile").files[0];
          if (videoFile) formData.append("videoFile", videoFile);
          if (imageFile) formData.append("imageFile", imageFile);

          const url = currentVideoId
            ? `${API_BASE}/api/update-video/${currentVideoId}`
            : `${API_BASE}/api/add-video`;
          const method = currentVideoId ? "PUT" : "POST";

          // Show upload progress
          document.getElementById("uploadProgress").style.display = "block";

          const xhr = new XMLHttpRequest();
          xhr.open(method, url, true);
          
          xhr.upload.onprogress = (e) => {
            if (e.lengthComputable) {
              const percent = Math.round((e.loaded / e.total) * 100);
              document.getElementById("progress-fill").style.width = percent + "%";
              document.getElementById("progress-text").textContent = `Téléchargement: ${percent}%`;
            }
          };

          xhr.onload = async () => {
            if (xhr.status === 200 || xhr.status === 201) {
              const action = currentVideoId ? "mise à jour" : "ajout";
              showAlert(
                "video-alert",
                `<i class="fas fa-check-circle"></i> Vidéo ${action}ée avec succès`,
                "success"
              );
              resetVideoForm();
              await loadVideosData();
              loadAllVideos();
              setTimeout(() => {
                document.querySelector('.tab[data-tab="videos-list"]')?.click();
              }, 1500);
            } else {
              throw new Error("Erreur serveur");
            }
          };

          xhr.onerror = () => showAlert("video-alert", '<i class="fas fa-wifi"></i> Erreur réseau', "danger");
          xhr.send(formData);
          
        } catch (e) {
          showAlert("video-alert", `<i class="fas fa-exclamation-triangle"></i> ${e.message}`, "danger");
        } finally {
          btn.innerHTML = original;
          btn.disabled = false;
          setTimeout(() => {
            document.getElementById("uploadProgress").style.display = "none";
          }, 2000);
        }
      }

      function resetVideoForm() {
        document.getElementById("video-form").reset();
        document.getElementById("video-form-title").innerHTML =
          '<i class="fas fa-video"></i> Ajouter une Vidéo';
        document.getElementById("video-submit-btn").innerHTML =
          '<i class="fas fa-save"></i> Ajouter la Vidéo';
        document.getElementById("cancel-edit-btn").style.display = "none";
        currentVideoId = null;
        document.getElementById("progress-fill").style.width = "0%";
        document.getElementById("progress-text").textContent = "Téléchargement: 0%";
      }

      function cancelEdit() {
        resetVideoForm();
        document.querySelector('.tab[data-tab="videos-list"]')?.click();
      }

      function toggleCategoryGroup() {
        const isPaid = document.getElementById("isPaid").value === "true";
        const group = document.getElementById("category-group");
        group.style.display = isPaid ? "block" : "none";
        
        if (!isPaid) {
          const cat = getRandomCategory();
          document.getElementById("category").value = cat;
          updatePartOptions();
          document.getElementById("part").value = getRandomPart(cat);
        }
      }

      function updatePartOptions() {
        const cat = document.getElementById("category").value;
        const select = document.getElementById("part");
        select.innerHTML = '<option value="">Sélectionner une partie</option>';
        
        if (partOptions[cat]) {
          partOptions[cat].forEach((p) => {
            const opt = document.createElement("option");
            opt.value = p;
            opt.textContent = p;
            select.appendChild(opt);
          });
        }
      }

      // ==================== USER MANAGEMENT ====================
      async function loadUsers() {
        updateLoader(80, 'Chargement des utilisateurs...');
        
        try {
          const res = await fetch(`${API_BASE}/api/users`);
          if (!res.ok) throw new Error("Échec du chargement");
          const data = await res.json();

          const tbody = document.querySelector("#users-table tbody");
          tbody.innerHTML = "";

          if (!data.users || data.users.length === 0) {
            tbody.innerHTML = `
              <tr>
                <td colspan="4" class="loading">
                  <i class="fas fa-info-circle"></i>
                  Aucun utilisateur trouvé
                </td>
              </tr>`;
            return;
          }

          data.users.forEach((u, index) => {
            const tr = document.createElement("tr");
            tr.style.opacity = "0";
            tr.style.transform = "translateY(20px)";
            tr.style.transition = "all 0.5s ease";
            
            tr.innerHTML = `
              <td style="font-weight:600">
                <div style="display:flex;align-items:center">
                  <div style="width:48px;height:48px;border-radius:50%;background:var(--gradient-primary);color:white;display:flex;align-items:center;justify-content:center;margin-right:1rem;font-weight:700;font-size:1.2rem;">
                    ${u.name.charAt(0).toUpperCase()}
                  </div>
                  <div>
                    <div style="font-weight:600;color:var(--dark)">${u.name}</div>
                    <div style="font-size:0.85rem;color:var(--gray-600)">Utilisateur</div>
                  </div>
                </div>
              </td>
              <td style="font-family:monospace;font-weight:600;color:var(--primary)">${u.phone}</td>
              <td>
                <div style="font-size:0.85rem;color:var(--gray-600);background:var(--gray-100);padding:0.5rem;border-radius:var(--border-radius);border:1px solid var(--gray-300)">
                  ${getUserStatus(u)}
                </div>
              </td>
              <td>
                <button class="action-btn reset-btn" data-phone="${u.phone}" title="Réinitialiser le mot de passe">
                  <i class="fas fa-key"></i>
                </button>
              </td>
            `;
            tbody.appendChild(tr);
            
            // Animate row appearance
            setTimeout(() => {
              tr.style.opacity = "1";
              tr.style.transform = "translateY(0)";
            }, index * 100);
          });

          document.querySelectorAll(".reset-btn").forEach((btn) => {
            btn.addEventListener("click", () =>
              openPasswordModal(btn.dataset.phone)
            );
          });
          
        } catch (e) {
          console.error("Erreur users:", e);
          showErrorState("users-table", "Erreur lors du chargement des utilisateurs");
        }
      }

      function getUserStatus(user) {
        const map = {
          informatiqueHardware: "Info Hardware",
          informatiqueSoftware: "Info Software",
          bureautiqueHardware: "Bureau Hardware",
          bureautiqueSoftware: "Bureau Software",
          marketingSocial: "Marketing Social",
          marketingContent: "Marketing Content",
          gsmHardware: "GSM Hardware",
          gsmSoftware: "GSM Software",
        };
        
        const status = Object.keys(map)
          .filter((k) => user.status?.[k])
          .map((k) => map[k]);
        
        return status.length ? status.join(", ") : "Aucun accès configuré";
      }

      async function handleUserSubmit(e) {
        e.preventDefault();
        const form = e.target;
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;

        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Création...';
        submitBtn.disabled = true;

        try {
          const data = {
            name: form["user-name"].value,
            phone: form["user-phone"].value,
            password: form["user-password"].value,
          };

          const res = await fetch(`${API_BASE}/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          if (res.ok) {
            showAlert(
              "user-alert",
              '<i class="fas fa-check-circle"></i> Utilisateur créé avec succès',
              "success"
            );
            form.reset();
            loadUsers();
            setTimeout(() => {
              document.querySelector('.tab[data-tab="users-list"]')?.click();
            }, 2000);
          } else {
            const error = await res.text();
            throw new Error(error || "Erreur serveur");
          }
        } catch (e) {
          console.error("Erreur lors de l'ajout:", e);
          showAlert(
            "user-alert",
            `<i class="fas fa-exclamation-triangle"></i> ${e.message}`,
            "danger"
          );
        } finally {
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
        }
      }

      function openPasswordModal(phone) {
        document.getElementById("reset-phone").value = phone;
        const modal = document.getElementById("password-modal");
        modal.style.display = "flex";
        setTimeout(() => modal.classList.add("show"), 10);
      }

      function closeModal() {
        const modal = document.getElementById("password-modal");
        modal.classList.remove("show");
        setTimeout(() => {
          modal.style.display = "none";
          document.getElementById("password-form").reset();
          document.getElementById("password-alert").innerHTML = "";
        }, 300);
      }

      async function sendOTP() {
        const phone = document.getElementById("reset-phone").value;
        const btn = document.getElementById("send-otp-btn");
        const original = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Envoi...';
        btn.disabled = true;

        try {
          const res = await fetch(`${API_BASE}/api/forgot-password`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ phone }),
          });

          if (res.ok) {
            showAlert("password-alert", '<i class="fas fa-check-circle"></i> Code OTP envoyé', "success");
          } else {
            throw new Error("Échec de l'envoi du code");
          }
        } catch (e) {
          showAlert("password-alert", `<i class="fas fa-exclamation-triangle"></i> ${e.message}`, "danger");
        } finally {
          btn.innerHTML = original;
          btn.disabled = false;
        }
      }

      async function handlePasswordReset(e) {
        e.preventDefault();
        const form = e.target;
        const btn = form.querySelector("button[type='submit']");
        const original = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Réinitialisation...';
        btn.disabled = true;

        try {
          const data = {
            phone: form["reset-phone"].value,
            otp: form["reset-otp"].value,
            newPassword: form["reset-new-password"].value,
          };

          const res = await fetch(`${API_BASE}/api/reset-password`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          if (res.ok) {
            showAlert(
              "password-alert",
              '<i class="fas fa-check-circle"></i> Mot de passe réinitialisé avec succès',
              "success"
            );
            setTimeout(closeModal, 2000);
          } else {
            throw new Error("Code OTP invalide ou expiré");
          }
        } catch (e) {
          showAlert("password-alert", `<i class="fas fa-exclamation-triangle"></i> ${e.message}`, "danger");
        } finally {
          btn.innerHTML = original;
          btn.disabled = false;
        }
      }

      // ==================== SETTINGS ====================
      async function loadScreenCaptureSetting() {
        try {
          const res = await fetch(`${API_BASE}/api/screen-capture`);
          if (!res.ok) throw new Error("Échec du chargement des paramètres");
          const data = await res.json();

          const toggle = document.getElementById("screen-capture-toggle");
          if (toggle) {
            toggle.checked = data.allowScreenCapture;
          }
        } catch (e) {
          console.error("Erreur paramètres:", e);
          showAlert(
            "settings-alert",
            '<i class="fas fa-exclamation-triangle"></i> Impossible de charger les paramètres',
            "danger"
          );
        }
      }

      async function toggleScreenCapture() {
        const enabled = this.checked;
        const label = this.closest('label');
        
        // Visual feedback
        label.style.opacity = '0.6';
        
        try {
          const res = await fetch(`${API_BASE}/api/screen-capture`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ allowScreenCapture: enabled }),
          });

          if (!res.ok) throw new Error("Échec de la mise à jour");
          
          showAlert(
            "settings-alert",
            `<i class="fas fa-check-circle"></i> Capture d'écran ${enabled ? "activée" : "désactivée"}`,
            "success"
          );
          
          label.style.borderColor = enabled ? 'var(--success)' : 'var(--gray-300)';
          
        } catch (e) {
          this.checked = !enabled;
          showAlert("settings-alert", '<i class="fas fa-exclamation-triangle"></i> Erreur de mise à jour', "danger");
        } finally {
          label.style.opacity = '1';
        }
      }

      // ==================== UTILITY FUNCTIONS ====================
      function setupTabs() {
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.addEventListener("click", () => {
            const tabId = tab.dataset.tab;
            const parent = tab.closest(".section");
            
            // Remove active class from all tabs and content
            parent
              .querySelectorAll(".tab, .tab-content")
              .forEach((el) => el.classList.remove("active"));
              
            // Add active class to clicked tab and corresponding content
            tab.classList.add("active");
            document.getElementById(`${tabId}-tab`).classList.add("active");
          });
        });
      }

      function setupTooltips() {
        document.addEventListener('mouseenter', function(e) {
          if (e.target.hasAttribute('title')) {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = e.target.title;
            document.body.appendChild(tooltip);
            
            const rect = e.target.getBoundingClientRect();
            tooltip.style.left = rect.left + rect.width / 2 - tooltip.offsetWidth / 2 + 'px';
            tooltip.style.top = rect.top - tooltip.offsetHeight - 8 + 'px';
            
            setTimeout(() => tooltip.style.opacity = '1', 10);
            
            e.target.addEventListener('mouseleave', () => tooltip.remove(), { once: true });
          }
        }, true);
      }

      function animateCounter(id, target) {
        const el = document.getElementById(id);
        const start = parseInt(el.textContent) || 0;
        const duration = 2000;
        const startTime = performance.now();
        
        function step(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const ease = 1 - Math.pow(1 - progress, 3);
          el.textContent = Math.round(start + (target - start) * ease);
          if (progress < 1) requestAnimationFrame(step);
        }
        requestAnimationFrame(step);
      }

      function showAlert(id, msg, type = "info") {
        const el = document.getElementById(id);
        if (el) {
          el.innerHTML = `<div class="alert alert-${type}">${msg}</div>`;
          setTimeout(() => {
            if (el.innerHTML.includes(msg)) {
              el.innerHTML = "";
            }
          }, 6000);
        }
      }

      function showErrorState(tableId, message) {
        const tbody = document.querySelector(`#${tableId} tbody`);
        tbody.innerHTML = `
          <tr>
            <td colspan="6" class="error-state">
              <i class="fas fa-exclamation-triangle"></i>
              ${message}
            </td>
          </tr>
        `;
      }

      function viewVideo(videoId) {
        const video = findVideoById(videoId);
        if (video?.details?.video) {
          window.open(`${API_BASE}${video.details.video}`, "_blank");
        } else {
          alert("Vidéo non disponible ou en cours de traitement");
        }
      }

      function findVideoById(id) {
        for (const cat of videosData) {
          const video = cat.videos?.find((v) => v.id === id);
          if (video) return { ...video, categoryName: cat.name };
        }
        return null;
      }

      // ==================== CONSOLE LOG ====================
      console.log("🚀 KaboreTech Admin Dashboard - Version améliorée chargée avec succès!");
      console.log("📊 Fonctionnalités disponibles:");
      console.log("  • Loader animé avec progression");
      console.log("  • Interface moderne et responsive");
      console.log("  • Gestion complète des vidéos");
      console.log("  • Système d'utilisateurs avancé");
      console.log("  • Paramètres de configuration");
      console.log("  • Animations et transitions fluides");
    </script>
  </body>
</html>
